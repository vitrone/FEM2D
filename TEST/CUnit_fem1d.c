#include <math.h>
#include <complex.h>
#include <stdio.h>
#include <stdlib.h>
#include <stdbool.h>
#include <string.h>
#include <errno.h>
#include "mkl.h"
#include "mkl_types.h"
#include "mkl_spblas.h"
#include "mkl_pardiso.h"

#define NDEBUG
#define MATLIB_NTRACE_DATA

#include "fem2d.h"

/* CUnit modules */
#include <CUnit/CUnit.h>
#include <CUnit/Basic.h>
#include <CUnit/TestDB.h>

/*============================================================================*/

static const matlib_real TOL = 1e-6;


/* Triangles */ 
#define NR_DOMAINS (647)
#define SIZE_ia (1941)

static const matlib_index ia[SIZE_ia] =
{

 228  , 	  267   , 	 241  , 
 0    ,           12    ,         3   ,
 25   ,           3     ,         12  ,
 264  ,           241   ,         267 ,
 20   ,           8     ,         6   ,
 19   ,           6     ,         4   ,
 20   ,           6     ,         19  ,
 14   ,           12    ,         0   ,
 0    ,           2     ,         14  ,
 330  ,           342   ,         344 ,
 325  ,           342   ,         330 ,
 10   ,           8     ,         24  ,
 24   ,           8     ,         20  ,
 271  ,           261   ,         280 ,
 327  ,           342   ,         325 ,
 319  ,           327   ,         305 ,
 315  ,           303   ,         332 ,
 228  ,           241   ,         212 ,
 212  ,           191   ,         228 ,
 189  ,           191   ,         212 ,
 267  ,           303   ,         284 ,
 284  ,           264   ,         267 ,
 303  ,           315   ,         284 ,
 7    ,           9     ,         18  ,
 18   ,           11    ,         7   ,
 22   ,           9     ,         15  ,
 31   ,           18    ,         22  ,
 22   ,           18    ,         9   ,
 62   ,           43    ,         52  ,
 52   ,           71    ,         62  ,
 16   ,           19    ,         4   ,
 4    ,           3     ,         16  ,
 3    ,           25    ,         16  ,
 165  ,           184   ,         174 ,
 174  ,           154   ,         165 ,
 175  ,           165   ,         156 ,
 184  ,           165   ,         175 ,
 89   ,           72    ,         78  ,
 65   ,           52    ,         46  ,
 71   ,           52    ,         65  ,
 156  ,           165   ,         144 ,
 144  ,           165   ,         154 ,
 292  ,           282   ,         301 ,
 310  ,           301   ,         291 ,
 291  ,           301   ,         282 ,
 262  ,           282   ,         272 ,
 272  ,           282   ,         292 ,
 292  ,           280   ,         272 ,
 272  ,           280   ,         261 ,
 340  ,           334   ,         321 ,
 321  ,           301   ,         310 ,
 319  ,           334   ,         343 ,
 343  ,           327   ,         319 ,
 342  ,           327   ,         343 ,
 343  ,           334   ,         340 ,
 319  ,           305   ,         300 ,
 300  ,           280   ,         292 ,
 336  ,           329   ,         323 ,
 332  ,           336   ,         323 ,
 323  ,           315   ,         332 ,
 290  ,           284   ,         302 ,
 302  ,           284   ,         315 ,
 315  ,           323   ,         302 ,
 77   ,           115   ,         102 ,
 57   ,           37    ,         77  ,
 17   ,           11    ,         29  ,
 12   ,           14    ,         26  ,
 26   ,           38    ,         46  ,
 14   ,           38    ,         26  ,
 35   ,           43    ,         25  ,
 35   ,           52    ,         43  ,
 35   ,           25    ,         12  ,
 12   ,           26    ,         35  ,
 46   ,           52    ,         35  ,
 35   ,           26    ,         46  ,
 36   ,           24    ,         20  ,
 19   ,           16    ,         32  ,
 25   ,           43    ,         32  ,
 32   ,           16    ,         25  ,
 125  ,           130   ,         146 ,
 184  ,           175   ,         195 ,
 195  ,           175   ,         186 ,
 235  ,           214   ,         224 ,
 184  ,           195   ,         203 ,
 203  ,           195   ,         214 ,
 157  ,           145   ,         137 ,
 137  ,           145   ,         127 ,
 167  ,           176   ,         157 ,
 160  ,           178   ,         171 ,
 148  ,           138   ,         129 ,
 160  ,           171   ,         148 ,
 55   ,           32    ,         43  ,
 49   ,           32    ,         55  ,
 55   ,           43    ,         62  ,
 62   ,           75    ,         55  ,
 49   ,           55    ,         68  ,
 68   ,           55    ,         75  ,
 62   ,           71    ,         83  ,
 83   ,           75    ,         62  ,
 72   ,           89    ,         94  ,
 94   ,           116   ,         100 ,
 94   ,           89    ,         106 ,
 106  ,           116   ,         94  ,
 71   ,           65    ,         90  ,
 90   ,           83    ,         71  ,
 101  ,           83    ,         90  ,
 46   ,           38    ,         60  ,
 60   ,           65    ,         46  ,
 23   ,           14    ,         2   ,
 23   ,           38    ,         14  ,
 108  ,           99    ,         120 ,
 129  ,           138   ,         120 ,
 129  ,           120   ,         109 ,
 109  ,           120   ,         99  ,
 29   ,           11    ,         27  ,
 27   ,           45    ,         29  ,
 11   ,           18    ,         27  ,
 27   ,           18    ,         31  ,
 29   ,           45    ,         48  ,
 73   ,           82    ,         63  ,
 63   ,           82    ,         67  ,
 67   ,           48    ,         63  ,
 63   ,           48    ,         45  ,
 74   ,           73    ,         58  ,
 73   ,           63    ,         58  ,
 58   ,           63    ,         45  ,
 72   ,           60    ,         50  ,
 50   ,           60    ,         38  ,
 232  ,           248   ,         239 ,
 257  ,           251   ,         276 ,
 322  ,           337   ,         335 ,
 335  ,           320   ,         322 ,
 333  ,           318   ,         329 ,
 340  ,           321   ,         333 ,
 310  ,           318   ,         333 ,
 333  ,           321   ,         310 ,
 111  ,           90    ,         100 ,
 101  ,           90    ,         111 ,
 221  ,           242   ,         256 ,
 217  ,           242   ,         221 ,
 299  ,           318   ,         310 ,
 310  ,           291   ,         299 ,
 253  ,           272   ,         261 ,
 262  ,           272   ,         253 ,
 209  ,           215   ,         198 ,
 186  ,           176   ,         197 ,
 274  ,           284   ,         290 ,
 264  ,           284   ,         274 ,
 262  ,           253   ,         243 ,
 243  ,           253   ,         236 ,
 227  ,           212   ,         241 ,
 309  ,           283   ,         305 ,
 309  ,           327   ,         325 ,
 309  ,           305   ,         327 ,
 305  ,           283   ,         288 ,
 288  ,           300   ,         305 ,
 288  ,           283   ,         271 ,
 271  ,           280   ,         288 ,
 280  ,           300   ,         288 ,
 301  ,           321   ,         314 ,
 292  ,           301   ,         314 ,
 314  ,           300   ,         292 ,
 314  ,           321   ,         334 ,
 314  ,           334   ,         319 ,
 319  ,           300   ,         314 ,
 313  ,           323   ,         329 ,
 313  ,           302   ,         323 ,
 329  ,           318   ,         313 ,
 318  ,           299   ,         313 ,
 290  ,           302   ,         313 ,
 313  ,           299   ,         290 ,
 133  ,           115   ,         150 ,
 133  ,           102   ,         115 ,
 74   ,           58    ,         54  ,
 37   ,           57    ,         34  ,
 15   ,           37    ,         34  ,
 34   ,           22    ,         15  ,
 31   ,           22    ,         34  ,
 34   ,           54    ,         31  ,
 57   ,           54    ,         34  ,
 80   ,           96    ,         74  ,
 80   ,           102   ,         96  ,
 74   ,           54    ,         80  ,
 80   ,           54    ,         57  ,
 77   ,           102   ,         80  ,
 80   ,           57    ,         77  ,
 5    ,           17    ,         1   ,
 11   ,           17    ,         5   ,
 7    ,           11    ,         5   ,
 76   ,           42    ,         56  ,
 19   ,           32    ,         33  ,
 33   ,           32    ,         49  ,
 49   ,           53    ,         33  ,
 33   ,           53    ,         36  ,
 20   ,           19    ,         33  ,
 33   ,           36    ,         20  ,
 244  ,           235   ,         224 ,
 224  ,           236   ,         244 ,
 244  ,           253   ,         261 ,
 236  ,           253   ,         244 ,
 255  ,           261   ,         271 ,
 255  ,           244   ,         261 ,
 235  ,           244   ,         255 ,
 214  ,           235   ,         223 ,
 223  ,           203   ,         214 ,
 157  ,           176   ,         166 ,
 166  ,           145   ,         157 ,
 166  ,           176   ,         186 ,
 186  ,           175   ,         166 ,
 166  ,           175   ,         156 ,
 156  ,           145   ,         166 ,
 119  ,           137   ,         127 ,
 119  ,           97    ,         108 ,
 108  ,           120   ,         128 ,
 128  ,           120   ,         138 ,
 128  ,           119   ,         108 ,
 137  ,           119   ,         128 ,
 157  ,           137   ,         147 ,
 147  ,           167   ,         157 ,
 147  ,           128   ,         138 ,
 137  ,           128   ,         147 ,
 204  ,           178   ,         189 ,
 189  ,           212   ,         204 ,
 212  ,           227   ,         204 ,
 187  ,           167   ,         177 ,
 176  ,           167   ,         187 ,
 187  ,           197   ,         176 ,
 177  ,           198   ,         187 ,
 158  ,           148   ,         171 ,
 177  ,           167   ,         158 ,
 158  ,           171   ,         177 ,
 167  ,           147   ,         158 ,
 138  ,           148   ,         158 ,
 158  ,           147   ,         138 ,
 93   ,           104   ,         87  ,
 75   ,           83    ,         95  ,
 95   ,           101   ,         113 ,
 95   ,           83    ,         101 ,
 72   ,           94    ,         81  ,
 81   ,           60    ,         72  ,
 65   ,           60    ,         81  ,
 81   ,           90    ,         65  ,
 81   ,           94    ,         100 ,
 100  ,           90    ,         81  ,
 67   ,           82    ,         91  ,
 108  ,           97    ,         91  ,
 91   ,           99    ,         108 ,
 91   ,           82    ,         99  ,
 92   ,           109   ,         99  ,
 92   ,           82    ,         73  ,
 99   ,           82    ,         92  ,
 96   ,           109   ,         92  ,
 92   ,           73    ,         74  ,
 74   ,           96    ,         92  ,
 59   ,           48    ,         67  ,
 45   ,           27    ,         44  ,
 44   ,           58    ,         45  ,
 44   ,           27    ,         31  ,
 31   ,           54    ,         44  ,
 44   ,           54    ,         58  ,
 78   ,           72    ,         61  ,
 72   ,           50    ,         61  ,
 39   ,           28    ,         47  ,
 47   ,           61    ,         39  ,
 39   ,           61    ,         50  ,
 38   ,           23    ,         39  ,
 39   ,           50    ,         38  ,
 341  ,           339   ,         331 ,
 326  ,           339   ,         337 ,
 337  ,           322   ,         326 ,
 297  ,           316   ,         306 ,
 304  ,           320   ,         293 ,
 304  ,           322   ,         320 ,
 338  ,           329   ,         336 ,
 338  ,           333   ,         329 ,
 340  ,           333   ,         338 ,
 174  ,           183   ,         163 ,
 163  ,           154   ,         174 ,
 154  ,           163   ,         143 ,
 143  ,           163   ,         153 ,
 181  ,           201   ,         192 ,
 106  ,           118   ,         126 ,
 126  ,           116   ,         106 ,
 156  ,           144   ,         135 ,
 135  ,           118   ,         127 ,
 144  ,           126   ,         135 ,
 135  ,           126   ,         118 ,
 135  ,           145   ,         156 ,
 127  ,           145   ,         135 ,
 107  ,           86    ,         97  ,
 127  ,           118   ,         107 ,
 107  ,           119   ,         127 ,
 97   ,           119   ,         107 ,
 146  ,           170   ,         164 ,
 159  ,           164   ,         182 ,
 146  ,           130   ,         151 ,
 151  ,           170   ,         146 ,
 151  ,           161   ,         170 ,
 192  ,           201   ,         210 ,
 170  ,           161   ,         179 ,
 179  ,           188   ,         170 ,
 200  ,           219   ,         208 ,
 208  ,           188   ,         200 ,
 192  ,           210   ,         200 ,
 200  ,           210   ,         219 ,
 200  ,           179   ,         192 ,
 188  ,           179   ,         200 ,
 87   ,           104   ,         105 ,
 105  ,           104   ,         125 ,
 216  ,           236   ,         224 ,
 205  ,           195   ,         186 ,
 186  ,           197   ,         205 ,
 214  ,           195   ,         205 ,
 224  ,           214   ,         205 ,
 205  ,           216   ,         224 ,
 197  ,           216   ,         205 ,
 264  ,           274   ,         247 ,
 241  ,           264   ,         247 ,
 247  ,           227   ,         241 ,
 245  ,           247   ,         263 ,
 263  ,           247   ,         274 ,
 233  ,           215   ,         209 ,
 226  ,           233   ,         209 ,
 245  ,           233   ,         226 ,
 209  ,           204   ,         226 ,
 226  ,           204   ,         227 ,
 226  ,           247   ,         245 ,
 227  ,           247   ,         226 ,
 307  ,           316   ,         297 ,
 307  ,           309   ,         325 ,
 325  ,           330   ,         307 ,
 330  ,           316   ,         307 ,
 276  ,           283   ,         295 ,
 283  ,           309   ,         295 ,
 309  ,           307   ,         295 ,
 139  ,           148   ,         129 ,
 160  ,           148   ,         139 ,
 155  ,           178   ,         160 ,
 160  ,           139   ,         155 ,
 155  ,           139   ,         133 ,
 49   ,           68    ,         69  ,
 69   ,           53    ,         49  ,
 69   ,           70    ,         53  ,
 68   ,           93    ,         69  ,
 69   ,           93    ,         87  ,
 87   ,           70    ,         69  ,
 24   ,           36    ,         41  ,
 76   ,           56    ,         84  ,
 84   ,           112   ,         76  ,
 84   ,           110   ,         112 ,
 161  ,           151   ,         141 ,
 130  ,           123   ,         141 ,
 141  ,           151   ,         130 ,
 265  ,           255   ,         271 ,
 271  ,           283   ,         265 ,
 276  ,           251   ,         265 ,
 265  ,           283   ,         276 ,
 251  ,           257   ,         238 ,
 238  ,           248   ,         232 ,
 238  ,           257   ,         248 ,
 203  ,           223   ,         213 ,
 246  ,           265   ,         251 ,
 255  ,           265   ,         246 ,
 235  ,           255   ,         246 ,
 246  ,           223   ,         235 ,
 190  ,           204   ,         209 ,
 178  ,           204   ,         190 ,
 190  ,           171   ,         178 ,
 209  ,           198   ,         190 ,
 177  ,           171   ,         190 ,
 190  ,           198   ,         177 ,
 104  ,           93    ,         114 ,
 114  ,           123   ,         130 ,
 130  ,           125   ,         114 ,
 125  ,           104   ,         114 ,
 85   ,           93    ,         68  ,
 85   ,           68    ,         75  ,
 75   ,           95    ,         85  ,
 2    ,           1     ,         13  ,
 13   ,           23    ,         2   ,
 1    ,           17    ,         13  ,
 17   ,           28    ,         13  ,
 13   ,           39    ,         23  ,
 28   ,           39    ,         13  ,
 47   ,           59    ,         66  ,
 66   ,           86    ,         78  ,
 78   ,           61    ,         66  ,
 66   ,           61    ,         47  ,
 48   ,           59    ,         40  ,
 29   ,           48    ,         40  ,
 47   ,           28    ,         40  ,
 40   ,           59    ,         47  ,
 40   ,           17    ,         29  ,
 40   ,           28    ,         17  ,
 324  ,           331   ,         339 ,
 339  ,           326   ,         324 ,
 324  ,           326   ,         312 ,
 259  ,           239   ,         248 ,
 259  ,           249   ,         239 ,
 242  ,           217   ,         230 ,
 230  ,           217   ,         207 ,
 207  ,           218   ,         230 ,
 328  ,           306   ,         316 ,
 341  ,           331   ,         328 ,
 344  ,           341   ,         328 ,
 328  ,           330   ,         344 ,
 328  ,           316   ,         330 ,
 322  ,           304   ,         311 ,
 312  ,           326   ,         311 ,
 311  ,           326   ,         322 ,
 242  ,           230   ,         254 ,
 100  ,           116   ,         122 ,
 122  ,           111   ,         100 ,
 153  ,           163   ,         173 ,
 173  ,           163   ,         183 ,
 162  ,           173   ,         181 ,
 142  ,           153   ,         162 ,
 153  ,           173   ,         162 ,
 193  ,           211   ,         201 ,
 201  ,           181   ,         193 ,
 193  ,           173   ,         183 ,
 181  ,           173   ,         193 ,
 86   ,           107   ,         98  ,
 98   ,           107   ,         118 ,
 98   ,           89    ,         78  ,
 78   ,           86    ,         98  ,
 106  ,           89    ,         98  ,
 98   ,           118   ,         106 ,
 182  ,           164   ,         180 ,
 170  ,           188   ,         180 ,
 180  ,           164   ,         170 ,
 168  ,           159   ,         182 ,
 168  ,           185   ,         149 ,
 149  ,           112   ,         136 ,
 112  ,           110   ,         136 ,
 136  ,           168   ,         149 ,
 159  ,           168   ,         136 ,
 146  ,           164   ,         140 ,
 164  ,           159   ,         140 ,
 140  ,           125   ,         146 ,
 159  ,           136   ,         140 ,
 220  ,           210   ,         201 ,
 201  ,           211   ,         220 ,
 232  ,           239   ,         220 ,
 220  ,           211   ,         232 ,
 225  ,           243   ,         236 ,
 236  ,           216   ,         225 ,
 215  ,           233   ,         225 ,
 225  ,           233   ,         243 ,
 197  ,           187   ,         206 ,
 206  ,           216   ,         197 ,
 206  ,           198   ,         215 ,
 206  ,           187   ,         198 ,
 215  ,           225   ,         206 ,
 206  ,           225   ,         216 ,
 273  ,           282   ,         262 ,
 273  ,           291   ,         282 ,
 281  ,           274   ,         290 ,
 281  ,           263   ,         274 ,
 290  ,           299   ,         281 ,
 281  ,           273   ,         263 ,
 281  ,           299   ,         291 ,
 291  ,           273   ,         281 ,
 276  ,           295   ,         285 ,
 285  ,           307   ,         297 ,
 285  ,           295   ,         307 ,
 102  ,           133   ,         117 ,
 133  ,           139   ,         117 ,
 96   ,           102   ,         117 ,
 117  ,           109   ,         96  ,
 129  ,           109   ,         117 ,
 117  ,           139   ,         129 ,
 189  ,           178   ,         169 ,
 178  ,           155   ,         169 ,
 150  ,           191   ,         169 ,
 169  ,           191   ,         189 ,
 169  ,           133   ,         150 ,
 169  ,           155   ,         133 ,
 24   ,           41    ,         30  ,
 10   ,           24    ,         30  ,
 30   ,           21    ,         10  ,
 42   ,           21    ,         30  ,
 30   ,           56    ,         42  ,
 30   ,           41    ,         56  ,
 56   ,           41    ,         64  ,
 64   ,           84    ,         56  ,
 132  ,           141   ,         123 ,
 132  ,           123   ,         113 ,
 234  ,           213   ,         223 ,
 223  ,           246   ,         234 ,
 251  ,           238   ,         234 ,
 234  ,           246   ,         251 ,
 202  ,           193   ,         183 ,
 211  ,           193   ,         202 ,
 184  ,           203   ,         194 ,
 203  ,           213   ,         194 ,
 213  ,           202   ,         194 ,
 174  ,           184   ,         194 ,
 194  ,           183   ,         174 ,
 194  ,           202   ,         183 ,
 103  ,           114   ,         93  ,
 93   ,           85    ,         103 ,
 123  ,           114   ,         103 ,
 113  ,           123   ,         103 ,
 103  ,           95    ,         113 ,
 103  ,           85    ,         95  ,
 79   ,           59    ,         67  ,
 79   ,           66    ,         59  ,
 86   ,           66    ,         79  ,
 97   ,           86    ,         79  ,
 67   ,           91    ,         79  ,
 79   ,           91    ,         97  ,
 248  ,           257   ,         270 ,
 270  ,           259   ,         248 ,
 270  ,           257   ,         276 ,
 276  ,           285   ,         270 ,
 297  ,           306   ,         287 ,
 249  ,           259   ,         266 ,
 266  ,           287   ,         277 ,
 260  ,           250   ,         268 ,
 331  ,           324   ,         308 ,
 308  ,           324   ,         312 ,
 312  ,           296   ,         308 ,
 240  ,           230   ,         218 ,
 240  ,           250   ,         260 ,
 260  ,           254   ,         240 ,
 240  ,           254   ,         230 ,
 275  ,           254   ,         260 ,
 143  ,           122   ,         134 ,
 154  ,           143   ,         134 ,
 116  ,           126   ,         134 ,
 134  ,           122   ,         116 ,
 134  ,           144   ,         154 ,
 134  ,           126   ,         144 ,
 111  ,           122   ,         131 ,
 131  ,           122   ,         143 ,
 131  ,           153   ,         142 ,
 131  ,           143   ,         153 ,
 172  ,           162   ,         181 ,
 172  ,           181   ,         192 ,
 192  ,           179   ,         172 ,
 172  ,           179   ,         161 ,
 161  ,           141   ,         152 ,
 152  ,           172   ,         161 ,
 162  ,           172   ,         152 ,
 142  ,           162   ,         152 ,
 152  ,           132   ,         142 ,
 141  ,           132   ,         152 ,
 207  ,           182   ,         199 ,
 182  ,           180   ,         199 ,
 199  ,           218   ,         207 ,
 208  ,           218   ,         199 ,
 199  ,           188   ,         208 ,
 199  ,           180   ,         188 ,
 196  ,           168   ,         182 ,
 207  ,           217   ,         196 ,
 196  ,           182   ,         207 ,
 185  ,           168   ,         196 ,
 221  ,           185   ,         196 ,
 196  ,           217   ,         221 ,
 124  ,           136   ,         110 ,
 124  ,           140   ,         136 ,
 110  ,           105   ,         124 ,
 124  ,           105   ,         125 ,
 125  ,           140   ,         124 ,
 210  ,           220   ,         231 ,
 237  ,           219   ,         231 ,
 219  ,           210   ,         231 ,
 231  ,           249   ,         237 ,
 239  ,           249   ,         231 ,
 231  ,           220   ,         239 ,
 262  ,           243   ,         252 ,
 252  ,           273   ,         262 ,
 252  ,           233   ,         245 ,
 243  ,           233   ,         252 ,
 245  ,           263   ,         252 ,
 263  ,           273   ,         252 ,
 51   ,           64    ,         41  ,
 36   ,           53    ,         51  ,
 51   ,           41    ,         36  ,
 53   ,           70    ,         51  ,
 70   ,           64    ,         51  ,
 84   ,           64    ,         88  ,
 88   ,           105   ,         110 ,
 110  ,           84    ,         88  ,
 87   ,           105   ,         88  ,
 88   ,           70    ,         87  ,
 88   ,           64    ,         70  ,
 222  ,           202   ,         213 ,
 222  ,           234   ,         238 ,
 213  ,           234   ,         222 ,
 222  ,           238   ,         232 ,
 232  ,           211   ,         222 ,
 211  ,           202   ,         222 ,
 259  ,           270   ,         278 ,
 278  ,           266   ,         259 ,
 287  ,           266   ,         278 ,
 297  ,           287   ,         278 ,
 278  ,           285   ,         297 ,
 278  ,           270   ,         285 ,
 286  ,           268   ,         277 ,
 286  ,           308   ,         296 ,
 260  ,           268   ,         279 ,
 279  ,           275   ,         260 ,
 279  ,           286   ,         296 ,
 268  ,           286   ,         279 ,
 258  ,           250   ,         237 ,
 258  ,           268   ,         250 ,
 237  ,           249   ,         258 ,
 277  ,           268   ,         258 ,
 258  ,           266   ,         277 ,
 249  ,           266   ,         258 ,
 331  ,           308   ,         317 ,
 317  ,           328   ,         331 ,
 306  ,           328   ,         317 ,
 229  ,           240   ,         218 ,
 250  ,           240   ,         229 ,
 208  ,           219   ,         229 ,
 229  ,           218   ,         208 ,
 229  ,           219   ,         237 ,
 237  ,           250   ,         229 ,
 294  ,           296   ,         312 ,
 312  ,           311   ,         294 ,
 294  ,           279   ,         296 ,
 275  ,           279   ,         294 ,
 293  ,           256   ,         269 ,
 269  ,           256   ,         242 ,
 242  ,           254   ,         269 ,
 254  ,           275   ,         269 ,
 111  ,           131   ,         121 ,
 113  ,           101   ,         121 ,
 101  ,           111   ,         121 ,
 121  ,           132   ,         113 ,
 142  ,           132   ,         121 ,
 121  ,           131   ,         142 ,
 308  ,           286   ,         298 ,
 298  ,           317   ,         308 ,
 277  ,           287   ,         298 ,
 298  ,           286   ,         277 ,
 298  ,           287   ,         306 ,
 306  ,           317   ,         298 ,
 289  ,           311   ,         304 ,
 289  ,           294   ,         311 ,
 289  ,           304   ,         293 ,
 293  ,           269   ,         289 ,
 275  ,           294   ,         289 ,
 289  ,           269   ,         275 
};

/* Nodes */ 
#define SIZE_p (690)
static const matlib_real p[SIZE_p] =
{
-1.0006805969279319868    ,   	 0.091676021434596091653      , 
-1.0004158117860757482    ,      -0.30533970177405894697      ,
-1.0003511754667691047    ,      -0.10533863652203617756      ,
-1.000206931053397863     ,       0.28965555578592555586      ,
-0.99858945109305374821   ,       0.47948425705483682657      ,
-0.99805911595992991003   ,      -0.49673465774628677849      ,
-0.98706142452938294696   ,       0.65291334630870145883      ,
-0.98171633107590428047   ,      -0.68966658413632686564      ,
-0.95259326345178985118   ,       0.79566832740483983688      ,
-0.9319526848721791934    ,      -0.83786799734554184838      ,
-0.89981537116369936236   ,       0.88158911948586426988      ,
-0.86695914555292852288   ,      -0.55155364948536311775      ,
-0.86694941335802067073   ,       0.18118113850161379763      ,
-0.86605515571693192367   ,      -0.22203095593557384269      ,
-0.86389404704205219332   ,       0.016064082686864673138     ,
-0.86221929932382812556   ,      -0.91573936827460378218      ,
-0.86060871919682513376   ,       0.40704895772120297526      ,
-0.85436941938938470997   ,      -0.3855722326293267721       ,
-0.85060813946604940661   ,      -0.70204250760847941581      ,
-0.84695805914066424336   ,       0.54185887410261501795      ,
-0.84367348589242019408   ,       0.66985708533808629994      ,
-0.8371949555708837476    ,       0.93243126903045370213      ,
-0.83109082667078038043   ,      -0.81311235968103467986      ,
-0.82521963438527068391   ,      -0.10108166824882344748      ,
-0.8226582490388496538    ,       0.77921482360824179114      ,
-0.81794959943026501747   ,       0.30423703816475661244      ,
-0.77352324460643206994   ,       0.09482443824185794734      ,
-0.77228796718190839687   ,      -0.61431616813212208683      ,
-0.76793882984190531271   ,      -0.26774231041700602418      ,
-0.76648929321937764314   ,      -0.47803030467470103426      ,
-0.76504035005066528541   ,       0.84782945068124904164      ,
-0.74800416022503657398   ,      -0.74071027195287486578      ,
-0.74296450107796752071   ,       0.43830693179915303226      ,
-0.73988066974540100951   ,       0.56735542466083632718      ,
-0.7395352252901077339    ,      -0.83958498177872087354      ,
-0.73852960671124390224   ,       0.20847593409124326458      ,
-0.73841655451810028765   ,       0.67846184195767877956      ,
-0.72746025925474055995   ,      -0.97425961424934148791      ,
-0.72664886550064067272   ,      -0.014608135630245143791     ,
-0.72298187944243841319   ,      -0.15107033559074040108      ,
-0.72256201349633630837   ,      -0.36318222030155206115      ,
-0.70451846499871750851   ,       0.76935180037577799439      ,
-0.70414298581817402756   ,       0.97920253566103798715      ,
-0.7006236557539725629    ,       0.32099034046801311337      ,
-0.69226464756212313656   ,      -0.67318924802984048128      ,
-0.68443231121036818276   ,      -0.55648177454852365553      ,
-0.6693565257469472618    ,       0.10055968482242076678      ,
-0.66075149691432177868   ,      -0.24941347761035947972      ,
-0.65503495651627918761   ,      -0.44751371590729038807      ,
-0.64670031532825733578   ,       0.50507202223768954408      ,
-0.64231481273702195622   ,      -0.070394317660786048796     ,
-0.64122787961026650461   ,       0.69643710756424759278      ,
-0.63921339431955848109   ,       0.20765525444598026406      ,
-0.63873506591996720427   ,       0.60577996000834255508      ,
-0.63071229213346358122   ,      -0.75881517020937105933      ,
-0.62954066678781062105   ,       0.40192506334489036535      ,
-0.62178546474585250081   ,       0.86022992186091318256      ,
-0.61810360327498103938   ,      -0.87286655114506317421      ,
-0.61471939540110664968   ,      -0.6403562151262344182       ,
-0.61181426267160521348   ,      -0.34603745972693533695      ,
-0.60375098075157995758   ,       0.023975015010783261998     ,
-0.60193998273284676781   ,      -0.15493125024536449907      ,
-0.59225579393868732492   ,       0.29739410805960631023      ,
-0.58938658224002793418   ,      -0.53055847441509185192      ,
-0.56319999106621398965   ,       0.77033853754492032095      ,
-0.56131121059347133251   ,       0.12153679391062949255      ,
-0.55551947246136978986   ,      -0.25498435862498025628      ,
-0.54948836172392445665   ,      -0.43464062892693433593      ,
-0.54664804583922899095   ,       0.4729575788939250347       ,
-0.54293396503419655286   ,       0.5635114412875528167       ,
-0.54204055796779149201   ,       0.664270349730816001        ,
-0.53454014731360388613   ,       0.20762224906239762356      ,
-0.53349516897844262431   ,      -0.051124795802950005752     ,
-0.52995055325899387277   ,      -0.60755381327334545549      ,
-0.52851786523942412277   ,      -0.71428793506536469859      ,
-0.52566862476074383004   ,       0.36691902960352668073      ,
-0.52342073225731777786   ,       0.99722135393370037182      ,
-0.52025846114244611584   ,      -0.99707618515146767546      ,
-0.50558249952497835711   ,      -0.16389573009271152237      ,
-0.50277731377996282003   ,      -0.34618735578955833754      ,
-0.50151667367516472584   ,      -0.82855988820323711597      ,
-0.49251308471701671365   ,       0.057266957485852899856     ,
-0.48694396101827919221   ,      -0.52038942837705270961      ,
-0.47697618042752010226   ,       0.27429736668227427954      ,
-0.46368711534521106499   ,       0.86358149363479630445      ,
-0.45995812824521997708   ,       0.43996016805465854027      ,
-0.45193281076030328292   ,      -0.25785238831615209243      ,
-0.45121423545328043225   ,       0.63166478990996044462      ,
-0.44775950098100997243   ,       0.74420817318165999321      ,
-0.44708888040195621238   ,      -0.09042456879007641779      ,
-0.44542215659257183846   ,       0.1617086544319641106       ,
-0.44379979431950017377   ,      -0.43578089134842579178      ,
-0.44123258351875804806   ,      -0.62943695276300404284      ,
-0.43805240062828665337   ,       0.53017012625694770467      ,
-0.42171850200780469642   ,      -0.003418285946495165737     ,
-0.41697009179828709025   ,       0.35072774968713305022      ,
-0.4137773472631747218    ,      -0.73515800288868227153      ,
-0.39781569770610880621   ,      -0.34885993002729398516      ,
-0.39732979425495623671   ,      -0.17653590317405443155      ,
-0.39112511655209314387   ,      -0.53722782136278146581      ,
-0.38133129572782059613   ,       0.08641603437868095039      ,
-0.37993488632829802709   ,       0.25219127824353554379      ,
-0.37585294688638715144   ,      -0.86048465831929943359      ,
-0.36531643219886567042   ,       0.44265867910897316317      ,
-0.35628667013123777041   ,       0.60666468844363863333      ,
-0.35229469676737729111   ,       0.70643617328204011407      ,
-0.34830822779931408517   ,      -0.084914374137808473764     ,
-0.34572219332617420973   ,      -0.26393227256105106227      ,
-0.34492512863872981654   ,      -0.44405977096051107988      ,
-0.34123351558269615635   ,      -0.64105518361193136734      ,
-0.33642869124654944946   ,       0.83871611739563822763      ,
-0.33002802826263022418   ,       0.17122385094001066341      ,
-0.32598401185008496483   ,       1.0000391455708350641       ,
-0.32037413713877355148   ,       0.34594343141855637969      ,
-0.31995634492822228045   ,       0.52694320581373077506      ,
-0.31978365623124527239   ,      -1.0003692489020268308       ,
-0.31460703728493399911   ,       0.0057861069493975987935    ,
-0.29830399499437959543   ,      -0.75102540310261367562      ,
-0.29535920421385680745   ,      -0.17425363042462876928      ,
-0.29507688153175226642   ,      -0.35427291043991565589      ,
-0.29280244252030729335   ,      -0.53930513213502218051      ,
-0.27297270999767564437   ,       0.25917726694087916961      ,
-0.26914374012139302694   ,       0.091775660412128895471     ,
-0.26528938869335594308   ,       0.43618116213333857356      ,
-0.25758424838276872126   ,       0.74655189627017137788      ,
-0.25346751685818846855   ,       0.6300183273724924149       ,
-0.24924013910036246777   ,      -0.082260100346638317936     ,
-0.2436563069237527579    ,      -0.26466609847676408895      ,
-0.24323004971221415249   ,      -0.44445436964443485461      ,
-0.24235854873873569071   ,      -0.63455341578597890262      ,
-0.21917932785906060755   ,       0.53174388906777159125      ,
-0.21840799282938003212   ,       0.17760846126263518663      ,
-0.21637159114108095448   ,       0.3471793663570966193       ,
-0.21624194640498614617   ,      -0.85816128421072679355      ,
-0.2082129830612704513    ,       0.0067542399629335310787    ,
-0.19483118076804875618   ,      -0.17327697521634918831      ,
-0.1920701283441937357    ,       0.85389365284998208772      ,
-0.19181280877436582277   ,      -0.35481304127262813797      ,
-0.19101049664162705888   ,      -0.53333093126270825213      ,
-0.18934439441066530652   ,      -0.72555950856658135706      ,
-0.16547570664971172905   ,       0.71161911453293447138      ,
-0.16534722035917129301   ,       0.4380822153730363766       ,
-0.16390278904601809917   ,       0.26438043770908165042      ,
-0.16065770034095264163   ,       0.093764533901736932253     ,
-0.148074591557503632     ,      -0.082325927140702512275     ,
-0.14201302954072636542   ,      -0.26374450258428933092      ,
-0.14186712736519072053   ,       0.61077031879547294402      ,
-0.13809331359849952303   ,      -0.44435883370587392349      ,
-0.13642727083279870826   ,      -0.61809048245778841491      ,
-0.13387593124511229514   ,       1.0005054055358622023       ,
-0.12032303015060082096   ,      -1.000495493320704421        ,
-0.11417942964746265189   ,       0.52349784675322841299      ,
-0.11042323108270307719   ,       0.35434469603642604341      ,
-0.10969954486975412589   ,       0.18063796240804716464      ,
-0.10290236913462778856   ,       0.0067317631855990560721    ,
-0.097353953363456618986  ,      -0.79261022776679723734      ,
-0.093389691319673132086  ,      -0.17244806701527098936      ,
-0.088834801419243533682  ,      -0.35334485919324465364      ,
-0.080815908894018961828  ,      -0.53282528003453022425      ,
-0.078777998918758210256  ,       0.76554966676431712713      ,
-0.072415195790971081946  ,      -0.69080551208879159564      ,
-0.057533859105197565631  ,       0.44446107971727372155      ,
-0.057377601526761676243  ,       0.26951282366084483577      ,
-0.054240620231665079287  ,       0.094588703622042566432     ,
-0.052426792051824516738  ,       0.65953941302341823061      ,
-0.045461875123070455418  ,      -0.082087950399685929992     ,
-0.03985068970372745295   ,      -0.26184857823291673995      ,
-0.03342902031655866496   ,      -0.44198069202964562763      ,
-0.031821208191182059899  ,       0.86395084615247386139      ,
-0.028665537065004218636  ,      -0.87379757575246608248      ,
-0.021346174833620255168  ,       0.55071533575285935846      ,
-0.011940805414280306757  ,      -0.61628989423739211073      ,
-0.0049356422744270623051 ,       0.35971523396343435541      ,
-0.0038394918431830290378 ,       0.18346546830400847772      ,
 0.0019988333800026094472 ,       0.0066550671722096516741    ,
 0.0092130762511487326177 ,      -0.1710662578921864907       ,
 0.014256384443007386401  ,      -0.35007172738762459829      ,
 0.027473155566536913708  ,      -0.52991168778699260233      ,
 0.030483118699894607567  ,      -0.73233840681886031021      ,
 0.040147682333170231495  ,       0.45760581654157128639      ,
 0.041572485023994937281  ,       0.63660046971833339491      ,
 0.047569434037543344151  ,       0.27363008508381392314      ,
 0.048061220553984360104  ,       0.74438010340179205926      ,
 0.050297927780689699606  ,       0.095592590759997209116     ,
 0.058439788107215367985  ,      -0.081974491002563265596     ,
 0.062670236875832938117  ,       1.0006253813215795212       ,
 0.06335144454505120537   ,      -0.25903135997895909703      ,
 0.070228954781621708015  ,      -0.43757961923839056029      ,
 0.089493634775945130055  ,       0.54419235354829609275      ,
 0.09007350781080281088   ,      -0.82820008933576061416      ,
 0.092047359209262727409  ,      -0.63514155232002411644      ,
 0.092956472613236890146  ,      -1.0004616454221864075       ,
 0.096340266795540696609  ,       0.36763654692435238092      ,
 0.10008895864730456282   ,       0.18571855865146172371      ,
 0.10639693721122416015   ,       0.0067439514689327023297    ,
 0.11344259401438058776   ,      -0.17034328193260300788      ,
 0.11533295674906564321   ,       0.85477152268918621392      ,
 0.11792929535263756147   ,      -0.34576776734101588584      ,
 0.12393867993873020072   ,      -0.53324645581043483844      ,
 0.13794911460078493337   ,       0.64430974143168717738      ,
 0.14686269720557623697   ,       0.45679987280863842969      ,
 0.14971894872585292391   ,       0.27781965909130074133      ,
 0.15330924655219430042   ,       0.096263141320429318482     ,
 0.16309662584962547616   ,      -0.081749832985490905601     ,
 0.16569663786114038895   ,      -0.72600188679216348664      ,
 0.16850930461963423146   ,      -0.25826398835464353665      ,
 0.17027664978709416976   ,      -0.43487584410867424767      ,
 0.17557546347063046621   ,       0.73856354158735937343      ,
 0.19551665181725394471   ,       0.55006031792333909269      ,
 0.19984909538674203167   ,      -0.61634334462528306275      ,
 0.20068958179042059586   ,       0.36765964972410053457      ,
 0.20208667513999792331   ,       0.18738605318584630743      ,
 0.20902706104592103098   ,      -0.86336042868940499062      ,
 0.21060598531971577718   ,       0.0066938483473971445437    ,
 0.21814974997460853667   ,      -0.16966741437398891179      ,
 0.22273836230998605989   ,      -0.52170866918478397967      ,
 0.22280059285772163546   ,      -0.34778690019651964382      ,
 0.24155568335606938946   ,       0.84511972371041821361      ,
 0.2480826982083083887    ,       0.64314472181147652741      ,
 0.2511286688708965209    ,       0.45857546564513940179      ,
 0.25273271534774194302   ,       0.27715287161324470011      ,
 0.25305151305630990688   ,       1.0003309855481907764       ,
 0.25478909530864679578   ,       0.096415452103597740208     ,
 0.26869938793334480209   ,      -0.081168326058773943021     ,
 0.27251340524545469846   ,      -0.25850566125104107451      ,
 0.276561308657770899     ,      -0.43876836649383432754      ,
 0.2831915699759288696    ,      -0.66315659523399206332      ,
 0.28368331837768406833   ,      -0.76504866817702599224      ,
 0.30122413207173576177   ,      -1.000571016621423226        ,
 0.30321482126132276447   ,       0.54880444299157649102      ,
 0.30375283014638670975   ,       0.73859928992663526071      ,
 0.30394464692930550642   ,       0.3660449261907635643       ,
 0.30431724068454407695   ,       0.18634005761154734393      ,
 0.31279187767284555299   ,      -0.54722577439518116371      ,
 0.31516886129659027471   ,       0.0065826383175403646933    ,
 0.3226594876289397007    ,      -0.1679301993047092878       ,
 0.32596597519782677388   ,      -0.34915186843961248941      ,
 0.35514403098625946242   ,       0.45332967569862409052      ,
 0.35544516830633210436   ,       0.094919864282507329656     ,
 0.35595934947163143658   ,       0.27407785901556069863      ,
 0.35992095706015853063   ,       0.64153040945661665706      ,
 0.36742165909658475176   ,      -0.86393091681530664872      ,
 0.3710123419065988748    ,       0.85677960158302712834      ,
 0.37229387955014964229   ,      -0.44862529747654189549      ,
 0.37513316400619978186   ,      -0.25640981987797423214      ,
 0.37518299421419670781   ,      -0.62859227605862122434      ,
 0.37648906800415604668   ,      -0.0779893987340605499       ,
 0.4015235798049719973    ,      -0.73172783729230395089      ,
 0.40742963332249326758   ,       0.18225646475109422151      ,
 0.40779011261679487532   ,       0.35826565976826252324      ,
 0.40822140755552749347   ,       0.5418206238222145199       ,
 0.42249117901520483187   ,       0.0077827993531653051271    ,
 0.4227808499156879285    ,      -0.53555345729669678878      ,
 0.42393225616171403836   ,      -0.35223776971005110736      ,
 0.42480062866528833787   ,       0.74312040708637305819      ,
 0.42667078324398166611   ,      -0.1601982759044586202       ,
 0.44875032221014538036   ,       0.99923207630309374139      ,
 0.45625862078951323619   ,       0.092345215254621706991     ,
 0.45750741098867131473   ,       0.44509015460708029055      ,
 0.46092905004307038741   ,       0.26045095608307383683      ,
 0.46402368932393828205   ,       0.63332942854733020877      ,
 0.47349502782992985983   ,      -0.25432950751131200295      ,
 0.47580126521998100664   ,      -0.44247829349169803814      ,
 0.47614599684838632143   ,      -0.63357399848723261471      ,
 0.4843551872480151288    ,      -0.83595955523489628991      ,
 0.49008660807144893701   ,      -0.061815102428316753835     ,
 0.50952247319545784787   ,       0.34539329331327811579      ,
 0.50993790671090832856   ,      -0.99740952400495352936      ,
 0.51095114498780214163   ,       0.53195910392545608936      ,
 0.51258966626319790727   ,       0.85308786124690605401      ,
 0.51554658005210796112   ,       0.15973665502777409375      ,
 0.52342338944447819316   ,      -0.15348028763136395414      ,
 0.52538885143761393515   ,      -0.34704674439989258161      ,
 0.52561376256105807325   ,      -0.53293305794128720265      ,
 0.52703816977239359431   ,      -0.73060761345984970294      ,
 0.53497899929027514787   ,       0.72478239789011922323      ,
 0.53741434423026623879   ,       0.037968391300752718509     ,
 0.55802524720256441171   ,       0.43186742873860939351      ,
 0.56253559128995700434   ,       0.24412147593854105487      ,
 0.56541461216522292954   ,       0.62036022770624210665      ,
 0.57354408572183290804   ,      -0.2493002598382797752       ,
 0.57754422571574437484   ,      -0.62271904307949144108      ,
 0.5804185976437812311    ,      -0.43630031385973649938      ,
 0.60058974772054640745   ,      -0.057316367086575767398     ,
 0.60760399938771325612   ,      -0.85229148038790936148      ,
 0.60842963481391876268   ,       0.12874020220033868811      ,
 0.61259340508144355386   ,       0.51964210758206652585      ,
 0.61358456942906558496   ,       0.33231644807374366435      ,
 0.61992843220157956008   ,      -0.15231049458657316964      ,
 0.62080463362417370732   ,       0.81419398686733046588      ,
 0.62988486436372370658   ,      -0.71841668431577998533      ,
 0.6302288964275271077    ,      -0.52751512734298644514      ,
 0.63137663418962397532   ,      -0.33482687198048638466      ,
 0.63566699154926764592   ,       0.98898636649405458066      ,
 0.64445126489536019854   ,       0.70394090771419071118      ,
 0.64500534071016757398   ,       0.032439039426477564443     ,
 0.65822220482881932391   ,       0.60489415117201317251      ,
 0.66038790760838872451   ,       0.21874259932267609008      ,
 0.6643344477958010863    ,       0.42944790761155376968      ,
 0.67658283523299078688   ,      -0.62450166724717359745      ,
 0.68497310782733622503   ,      -0.23173487773111467458      ,
 0.68993677009898857211   ,      -0.42357124120177680471      ,
 0.70374967111681296927   ,      -0.79169449608812192398      ,
 0.70778764685263173551   ,      -0.97847452814974500424      ,
 0.71649164308275758994   ,       0.85998527892140874673      ,
 0.71662099130340173314   ,      -0.11235486359752926144      ,
 0.71799663675368019522   ,       0.32071104795500648965      ,
 0.72775537128930134489   ,       0.11309128001322170387      ,
 0.73234879508240424695   ,       0.52740506199905567986      ,
 0.73572054361748950857   ,      -0.015340216669647710815     ,
 0.73857935351577819194   ,      -0.51662761013201086158      ,
 0.73907855127025090525   ,       0.75451426123440035187      ,
 0.74067704925954402917   ,       0.65491069664940582129      ,
 0.74456848238628936532   ,      -0.71337285708181841226      ,
 0.74733487496066208777   ,      -0.32170094952593902837      ,
 0.76292865089800521172   ,      -0.87318092124036628121      ,
 0.77148204713139634237   ,       0.2243607242255325207       ,
 0.77331731424454508428   ,       0.41473918372545293121      ,
 0.78362775172342025165   ,      -0.61310636016163555517      ,
 0.80095052653411602517   ,      -0.20121669901515354395      ,
 0.80364738982403005618   ,       0.94952751662588597004      ,
 0.82097372296245418877   ,      -0.42072158761855077413      ,
 0.8230517451144619967    ,       0.82104153430404658298      ,
 0.82406075753027230313   ,      -0.80094776521740451702      ,
 0.83606083557372423698   ,       0.59701623167735640152      ,
 0.83746554774527004472   ,       0.036738993428760177706     ,
 0.84846155866924954925   ,       0.71525982001323362702      ,
 0.85893269018078244326   ,      -0.095149177077008734171     ,
 0.86063473736759388277   ,       0.31940720496187746669      ,
 0.86232196502657210146   ,      -0.69849493896887770994      ,
 0.86623116982984882384   ,       0.15456302843989896956      ,
 0.86675503616256588391   ,       0.48337027386119818528      ,
 0.86934074270668104667   ,      -0.910354759398407265        ,
 0.87797948519669832823   ,      -0.53658613761655404861      ,
 0.88053725483639433413   ,      -0.29968550510984531821      ,
 0.89373360627869891104   ,       0.88825810762652235297      ,
 0.94159168879637733518   ,      -0.82020277023994614396      ,
 0.95452952425614734366   ,       0.79136327153008434454      ,
 0.98864037511815339165   ,      -0.64316553329271874961      ,
 0.99038547512933183814   ,       0.62345065650093622889      ,
 0.99959106400130626202   ,      -0.4224064851529300002       ,
 0.99971291318225496969   ,       0.42250757236054697907      ,
 1.00039583746111016      ,       0.013962947378390039646     ,
 1.0004103897712277593    ,      -0.19620814558033949915      ,
 1.000611308580233505     ,       0.2214611578006082937       
};

#define NR_QNODES 6

static const matlib_real xi4[2*NR_QNODES] = 
{
    -1.081030181680703e-01,    -7.837939636638594e-01, 
    -1.081030181680702e-01,    -1.081030181680701e-01,
    -7.837939636638596e-01,    -1.081030181680699e-01,
    -8.168475729804587e-01,    -8.168475729804582e-01,
     6.336951459609168e-01,    -8.168475729804585e-01,
    -8.168475729804581e-01,     6.336951459609170e-01,
};

static const matlib_real qwa[NR_QNODES] = 
{
     4.467631793560230e-01, 
     4.467631793560230e-01,
     4.467631793560230e-01,
     2.199034873106438e-01,
     2.199034873106438e-01,
     2.199034873106438e-01,
};

/* array of centroids */ 
#define SIZE_ca (1941)
static const matlib_real ca[SIZE_ca] = 
{
 0.39286123262640959553   , 	 -0.953970485813894431        , 
-0.95594564711311680316   ,       0.18750423857404516226      ,
-0.89503531461389451707   ,       0.25835791081743197939      ,
 0.45390491768516944004   ,      -0.89909999868505208198      ,
-0.92777605795786433074   ,       0.70614625301720923556      ,
-0.94420297825436705352   ,       0.55808549248871774928      ,
-0.89256432318748901711   ,       0.62154310191646766626      ,
-0.91050801910933498728   ,       0.096307080874358186318     ,
-0.95497527314558450229   ,       0.00080048919980819574493   ,
 0.95574610529039760731   ,       0.1299957112062991027       ,
 0.90136418501207637988   ,       0.068421656415683054786     ,
-0.89168896121811291877   ,       0.81882409016631518828      ,
-0.87297499946101986268   ,       0.74824674545038938334      ,
 0.52348750099874707953   ,      -0.21903668499365192002      ,
 0.89893135846238747533   ,      -0.01481574542328616996      ,
 0.79216806933943340052   ,      -0.13624024656323049931      ,
 0.78001901348577273865   ,      -0.92067006959617281314      ,
 0.29255761740474722776   ,      -0.90928745404204491809      ,
 0.20106922191029788505   ,      -0.95479769691100491169      ,
 0.13068568048998691067   ,      -0.89734072114911744844      ,
 0.60844318431708444006   ,      -0.94272517751420270571      ,
 0.53396569778221225633   ,      -0.89522018654258639359      ,
 0.69277343237944999377   ,      -0.90131564325934032667      ,
-0.92142571847137766383   ,      -0.74319236303011593225      ,
-0.89976120536496073665   ,      -0.64775424707672313307      ,
-0.87508760362226256646   ,      -0.85557324176705995544      ,
-0.80990104212062208333   ,      -0.7519550464141295798       ,
-0.87121721700300291946   ,      -0.78434095487835209237      ,
-0.64403094800407278964   ,       0.27534656765786658106      ,
-0.58866977852394997139   ,       0.23755720385599474187      ,
-0.90205207647684770844   ,       0.47613069629288490292      ,
-0.95313503378109221131   ,       0.39206292352065513773      ,
-0.89292174989349604175   ,       0.33364718389062836268      ,
 0.0049922487880491740048 ,      -0.052469124743346508277     ,
-0.048788470292565215558  ,      -0.022900373347292408283     ,
-0.043212830063864948738  ,      -0.1418674251023811228       ,
 0.0073969964117645489732 ,      -0.11170956643147855747      ,
-0.49538884963512569426   ,      -0.1018150315619126417       ,
-0.62329371021999235847   ,       0.14325057772634350317      ,
-0.57835491740887789991   ,       0.17893809913966909897      ,
-0.095642052666749077794  ,      -0.11228731485188647721      ,
-0.098812945271733954034  ,      -0.052560704784929794531     ,
 0.63391066731079792618   ,      -0.39823280901399993326      ,
 0.68624834001409806827   ,      -0.48923799289225805564      ,
 0.63352808805676563697   ,      -0.46246222746816662008      ,
 0.52720290476712539096   ,      -0.40860845058377570638      ,
 0.57906136109033967685   ,      -0.37272464341337180338      ,
 0.57676985711635697651   ,      -0.31039129207288623791      ,
 0.52414265499645895652   ,      -0.28355883724982811067      ,
 0.90036734726671829865   ,      -0.38093785929377538269      ,
 0.74982994885907361393   ,      -0.45364014631744614681      ,
 0.89396605704724596553   ,      -0.23237011656844611118      ,
 0.88676453549537548326   ,      -0.16419134055750059242      ,
 0.9532463058043734172    ,      -0.092464791759652720238     ,
 0.96017956953630945183   ,      -0.30610004528103829102      ,
 0.73418154188828455009   ,      -0.18176881344793249795      ,
 0.62996460924626429545   ,      -0.27195400318329360223      ,
 0.87599147045107395027   ,      -0.77321515814207619766      ,
 0.87833106301111030234   ,      -0.84383509828525260499      ,
 0.81877671704498611316   ,      -0.86149448195205924339      ,
 0.64707951162275001433   ,      -0.78746755359727049761      ,
 0.69142744046751047904   ,      -0.83905563257213255923      ,
 0.76357969318169682804   ,      -0.82194106084863083339      ,
-0.40529835475335951323   ,      -0.95264336412426464662      ,
-0.6219407745573892754    ,      -0.94806745018195748287      ,
-0.829272619387230292     ,      -0.47171872892979699321      ,
-0.83478890166883490398   ,       0.097356553143445476173     ,
-0.7231762119513400755    ,       0.06025866247801118375      ,
-0.78802205238304168233   ,       0.032093461766159160631     ,
-0.75236762063182716087   ,       0.27790110424133768197      ,
-0.69278888559492501908   ,       0.24570717633507888067      ,
-0.80780953983317649314   ,       0.23129803691920455821      ,
-0.79300075489189880695   ,       0.16149383694490501706      ,
-0.68236650892591654838   ,       0.17223029111988141793      ,
-0.727136459021541115     ,       0.13462001905184065031      ,
-0.80158276314978993415   ,       0.70917791696800236423      ,
-0.81684375980515222526   ,       0.46240492120765702699      ,
-0.75384591875406847805   ,       0.35451143681064095636      ,
-0.80717427323501922398   ,       0.38319764256170424366      ,
-0.20483799069414657112   ,       0.59084417841191227971      ,
 0.060365152790914894387  ,      -0.14112801027578425472      ,
 0.062002371603526840182  ,      -0.20014696660124953187      ,
 0.27110754761633432119   ,      -0.1987010916432464247       ,
 0.11165966932374048193   ,      -0.11135586864021906894      ,
 0.16489632327953820945   ,      -0.14058684309736094176      ,
-0.14088687991144524525   ,      -0.32396746768338735567      ,
-0.19249404841294828761   ,      -0.29440788077789387112      ,
-0.036002479097598273639  ,      -0.38179909287017160802      ,
-0.017957627501785592555  ,      -0.67981127104834804253      ,
-0.18993210540438712486   ,      -0.59532494316882511587      ,
-0.07359442401268335987   ,      -0.64172862959465737376      ,
-0.69104294120658360523   ,       0.38707411187068546665      ,
-0.67306849439801175183   ,       0.44843467246057766573      ,
-0.64080670549349016962   ,       0.34010317062416994816      ,
-0.582488361829080592     ,       0.35541273366934111877      ,
-0.60762967598509909362   ,       0.45998488815883503689      ,
-0.56728577912926114735   ,       0.41393389061411406393      ,
-0.53459070722660373409   ,       0.25977124126809275628      ,
-0.53163353304231708574   ,       0.31287016811513573833      ,
-0.46743418379606782587   ,      -0.048322550179840523255     ,
-0.37255227834018644906   ,       0.029594618460527796072     ,
-0.4057052034030250165    ,      -0.059585742958126686197     ,
-0.36154458903068426023   ,      -0.027515517711635347625     ,
-0.51375783816654896352   ,       0.16362256580166376074      ,
-0.48564616144456529412   ,       0.21454275672554534715      ,
-0.43411107444946334111   ,       0.22939909978592465389      ,
-0.66658545733305596404   ,       0.036642188067652965711     ,
-0.61147290569733281362   ,       0.082023831247944503642     ,
-0.89648828563136395697   ,      -0.063452074027998309202     ,
-0.8052541823093211093    ,      -0.033208573730734637641     ,
-0.3429508959037101401    ,      -0.50686424148610498275      ,
-0.24205716263355667173   ,      -0.56906315972790311175      ,
-0.29213150228057971347   ,      -0.60497124384431077981      ,
-0.34172035821836549419   ,      -0.57252937903657830088      ,
-0.80191213531807148396   ,      -0.54796670743072872778      ,
-0.74106985720388474093   ,      -0.5496094157851155737       ,
-0.82995175073362881246   ,      -0.6226374417419882068       ,
-0.79030008895766490351   ,      -0.68568964923115871546      ,
-0.70198552031534167117   ,      -0.49400859837683835929      ,
-0.53542703217243359237   ,      -0.552833905355163302        ,
-0.54193963499407715734   ,      -0.49519617723969294731      ,
-0.59796996682674385948   ,      -0.4709042730831055068       ,
-0.64295128332222517553   ,      -0.51151798829030192817      ,
-0.5577292712998415114    ,      -0.65406598782164815375      ,
-0.57801884363337618922   ,      -0.59282283427155724187      ,
-0.62951276295050095921   ,      -0.57579882136328330855      ,
-0.59318698748901488305   ,      -0.032514699484317600986     ,
-0.65757155299641423252   ,      -0.020342479426749309618     ,
 0.3559020744928895752    ,       0.21422479379273409728      ,
 0.47205471467832804677   ,       0.046032135302846576008     ,
 0.89043829188310275047   ,       0.83355430448688438982      ,
 0.840144247072397099     ,       0.88627571951881822798      ,
 0.84130973398223030113   ,      -0.61606247891568910457      ,
 0.89951475738681951899   ,      -0.45990473679601162615      ,
 0.8000621968119655536    ,      -0.55544003597006685879      ,
 0.81251085389164356965   ,      -0.49131177845570522811      ,
-0.38559382686100751592   ,       0.13978284658355191739      ,
-0.38512835706116671508   ,       0.19504126120517009668      ,
 0.35760472572435136884   ,       0.95211422114477051171      ,
 0.28853984610632604779   ,       0.90074343694721203946      ,
 0.73292998015739641016   ,      -0.5847452125136066714       ,
 0.68179702839209854748   ,      -0.55621480157405700506      ,
 0.47427204514308596295   ,      -0.31787134054041860098      ,
 0.47504079093976964154   ,      -0.38058760253388057571      ,
 0.18217537921181944927   ,      -0.55709948987350055294      ,
 0.065179041446898719481  ,      -0.31829028490253319372      ,
 0.58817567784127688935   ,      -0.76710525938784634992      ,
 0.53966578546937393757   ,      -0.80628621636088515512      ,
 0.42400913364394821059   ,      -0.41444712022609703217      ,
 0.37406403696989681817   ,      -0.38333831187540184926      ,
 0.28671067950672995961   ,      -0.83078000456057921053      ,
 0.68431042754714599408   ,      -0.061670482451250917266     ,
 0.81070626051451399885   ,      -0.024583466772632091984     ,
 0.770424741700557969     ,      -0.074281419114728561293     ,
 0.64571305707517590022   ,      -0.10732724175689273283      ,
 0.67384084377743924676   ,      -0.16546674530507238243      ,
 0.58131385645553468322   ,      -0.12103571643483762577      ,
 0.57229863578929685008   ,      -0.18503034735207232742      ,
 0.62614854191691626806   ,      -0.21111521071865588239      ,
 0.75274845600736828288   ,      -0.38866459278208886907      ,
 0.68954942641642491541   ,      -0.36003302090273409108      ,
 0.68789487232587409604   ,      -0.29608756641251332553      ,
 0.81628195091983679621   ,      -0.3473693474181117069       ,
 0.80960755211039081569   ,      -0.27420105121697929684      ,
 0.744419503107371483     ,      -0.25155084209073574897      ,
 0.81031706831437799732   ,      -0.73760518708936684273      ,
 0.75745963701112495325   ,      -0.76867170612911495109      ,
 0.79683939971209394315   ,      -0.67499138540411063314      ,
 0.73492635644756676427   ,      -0.65032696149687596598      ,
 0.69273433928894201372   ,      -0.74116134582857340352      ,
 0.68367872732766798993   ,      -0.68543040288159062801      ,
-0.21878287759561076964   ,      -0.95300867547781942246      ,
-0.30395951650753955109   ,      -0.90633839714401764898      ,
-0.59131651759133141422   ,      -0.70448644013365679939      ,
-0.6950330292732763704    ,      -0.89557038239104180821      ,
-0.77640492795622539912   ,      -0.90986132143422204788      ,
-0.81094845042823882064   ,      -0.85614556991145318587      ,
-0.77287673739530815542   ,      -0.79780253780421006571      ,
-0.70608389254953596303   ,      -0.77970347464698885886      ,
-0.66278370689951748851   ,      -0.82375556771105173937      ,
-0.48127062872592119014   ,      -0.75933527538576139904      ,
-0.43038232260824216269   ,      -0.8080675164704063107       ,
-0.55358227701601736559   ,      -0.76722099782599084694      ,
-0.58344418969453648582   ,      -0.82008053651922374616      ,
-0.4658760272346659792    ,      -0.89537357722466814902      ,
-0.54662624603086396036   ,      -0.89950087483325591453      ,
-0.95094811571179682641   ,      -0.39588219738322411034      ,
-0.90646256030074778831   ,      -0.47795351328699225979      ,
-0.94891153086292090446   ,      -0.57931829712265892063      ,
-0.61644972760711480575   ,       0.94555127048521725452      ,
-0.77660107665467759119   ,       0.51584041018753479246      ,
-0.70984849538387528867   ,       0.5035781262325595975       ,
-0.6751053503312084425    ,       0.55940246896895617912      ,
-0.70567743006115613014   ,       0.61719907554228592428      ,
-0.81017073825949514898   ,       0.59302379470051258537      ,
-0.77399023671864053409   ,       0.63855811731886713556      ,
 0.32343535229353137517   ,      -0.22761522681124154999      ,
 0.32453751481649378841   ,      -0.28802244985620922835      ,
 0.42418681599928120818   ,      -0.28765903236644579932      ,
 0.37501046512191349436   ,      -0.31926648600921264665      ,
 0.47452973350612986936   ,      -0.18933602368237820168      ,
 0.4250996583600371026    ,      -0.22364586776458161843      ,
 0.37482114495970703105   ,      -0.19484609836238067637      ,
 0.26983620851229767057   ,      -0.13958864657915739937      ,
 0.21664858791919294756   ,      -0.11086185780608459606      ,
-0.038143035559987860383  ,      -0.32175505493792866396      ,
-0.090232840221232457623  ,      -0.29297931333681687116      ,
 0.012585713094777045695  ,      -0.2903172218665001636       ,
 0.0109046103641574927    ,      -0.2306487320346874148       ,
-0.041342434924083952541  ,      -0.20178763438012473075      ,
-0.091751136854708981172  ,      -0.23268038261082568674      ,
-0.24351533240995693053   ,      -0.32458401672976933128      ,
-0.34593923595886361122   ,      -0.38239753714257362915      ,
-0.29365254029041709671   ,      -0.47593975757998935316      ,
-0.24234766295804952008   ,      -0.50569681101405505874      ,
-0.29441068662756542107   ,      -0.41426235034828717829      ,
-0.24337324667277740464   ,      -0.38451344045232627167      ,
-0.13958030793070294595   ,      -0.3841722447239155902       ,
-0.086785711778100571578  ,      -0.41322812830958804975      ,
-0.19077795331744692997   ,      -0.47404804487100565824      ,
-0.19104539069502649018   ,      -0.41454208154097899053      ,
 0.09541775479061261056   ,      -0.76218012764892806299      ,
 0.15493240223928808619   ,      -0.80585413493910973415      ,
 0.21946900576158182017   ,      -0.78480366121953137881      ,
 0.021424363343866648784  ,      -0.46982399968500959675      ,
 0.017018772969356808084  ,      -0.4098773462185535954       ,
 0.067471544859088891655  ,      -0.37780637132234368147      ,
 0.07388026342896293619   ,      -0.50024592094527264852      ,
-0.076394661713699324457  ,      -0.58906855224323695364      ,
-0.028923924548013568714  ,      -0.50157255328372285508      ,
-0.021761186247254118292  ,      -0.5596756206863049421       ,
-0.084112747603025714294  ,      -0.47305493525668323995      ,
-0.13608455878948158557   ,      -0.56141556458500885274      ,
-0.13663990637804851458   ,      -0.50350501500103750363      ,
-0.41518443540426824834   ,       0.58949986820351563122      ,
-0.47320496566218367418   ,       0.33064804865764468866      ,
-0.37242637175511955627   ,       0.31628748644974163939      ,
-0.42462705285136842503   ,       0.29240546487098101336      ,
-0.48257558523442134479   ,       0.00090795857880257568873   ,
-0.54325307814901313552   ,       0.010039058897895384789     ,
-0.55252509202068933458   ,       0.067592922135755212354     ,
-0.49974881730101988753   ,       0.11350413527614883202      ,
-0.43185429415088066873   ,       0.046754901972679563382     ,
-0.43975551234580301241   ,       0.10179721543216598001      ,
-0.49341070568723460754   ,      -0.4636036495508042421       ,
-0.395513540221446247     ,      -0.40956686411207693377      ,
-0.39328334650344104473   ,      -0.47235616122390605698      ,
-0.44062295729662420696   ,      -0.4977993803627533409       ,
-0.39119707188451585678   ,      -0.60257331924590562533      ,
-0.48604236593201033401   ,      -0.58579339813780073598      ,
-0.43976722036304344288   ,      -0.5623514008342794801       ,
-0.39874781545487630874   ,      -0.66855004642120585689      ,
-0.49990033400572536637   ,      -0.65042623370057139898      ,
-0.4611759320071189272    ,      -0.69296096357235026364      ,
-0.6054458603039362119    ,      -0.40939726818705340916      ,
-0.71632830865146657207   ,      -0.61466239690349544489      ,
-0.66380545139119939702   ,      -0.62334241256819955534      ,
-0.73751892498968940615   ,      -0.67607189603827910762      ,
-0.6903270333068745046    ,      -0.72423823006402887614      ,
-0.64589877836556441881   ,      -0.69078687778848202328      ,
-0.54700588374542258308   ,      -0.12331725871367534009      ,
-0.59258332148277048645   ,      -0.092150121236366858146     ,
-0.71722406873288857554   ,      -0.22274204120603532941      ,
-0.66189111969653557921   ,      -0.18513835448215476553      ,
-0.65574555830410241608   ,      -0.12546530116563034407      ,
-0.75828345977611666395   ,      -0.088920046489936330203     ,
-0.69731518589336705105   ,      -0.07869092962725719731      ,
 0.95228447482471756391   ,       0.50977616757422716809      ,
 0.93112551935157628069   ,       0.7100245826814179928       ,
 0.87534760934661959286   ,       0.77588820861578822186      ,
 0.71662219716448838369   ,       0.2546047905010717094       ,
 0.71860200815201835667   ,       0.93283305401378313615      ,
 0.78106359267374980693   ,       0.87685144328378050727      ,
 0.93085134298036764644   ,      -0.72062108083384757151      ,
 0.90964727511380794045   ,      -0.62608220329271679905      ,
 0.95540364143871936431   ,      -0.53405271868740100683      ,
-0.0006479530236575894997 ,       0.065612120518083141829     ,
-0.051714718662096752222  ,       0.035991844659950422702     ,
-0.10593356323574849853   ,       0.065028333569792859392     ,
-0.10819928848079062023   ,       0.12299706664394222111      ,
 0.097876216519645661829  ,       0.3063620970331557003       ,
-0.29763585703784445347   ,      -0.11380936830302519625      ,
-0.30405180139487014701   ,      -0.053796122511683065748     ,
-0.1454318212150751688    ,      -0.14268365645744088277      ,
-0.24461556396855277384   ,      -0.2040655680392473581       ,
-0.19738197047530495198   ,      -0.11262100090123000617      ,
-0.24647684136075601047   ,      -0.14326356866253875388      ,
-0.14341130054281606143   ,      -0.20315651493863651211      ,
-0.193500172410842608     ,      -0.23389585875913421198      ,
-0.39849023393086208111   ,      -0.29021486363483239845      ,
-0.29491256815459460094   ,      -0.23428400048748132534      ,
-0.29481846059389305026   ,      -0.29429042715924363938      ,
-0.34620492418801179779   ,      -0.32235503767608691961      ,
-0.071880031416878500949  ,       0.6070083558572502147       ,
-0.027714523472199461412  ,       0.723156394396509139        ,
-0.15840862829057131278   ,       0.55533735153882435309      ,
-0.09246424394875789321   ,       0.5616611671005202755       ,
-0.064353154528760156405  ,       0.50622475407445388651      ,
 0.14891626577060473879   ,       0.33770528524658455227      ,
-0.0129107838685491947    ,       0.48426074400390145547      ,
 0.036098380758498367638  ,       0.5175045019475755792       ,
 0.19783600596457559528   ,       0.48847855212570562289      ,
 0.14395766126625841874   ,       0.51701751476009116804      ,
 0.14796418193051250056   ,       0.39736535648569715207      ,
 0.19956031595563109016   ,       0.42767832939262612202      ,
 0.09445021544476239761   ,       0.42734741209152066199      ,
 0.092168004771563880051  ,       0.48619934763283528811      ,
-0.38659853411729844241   ,       0.64825521721187973068      ,
-0.32068296125226786186   ,       0.64770639636605709111      ,
 0.27375999110033438777   ,      -0.31848147662905773592      ,
 0.1151011143930220082    ,      -0.22921287675540188977      ,
 0.11659668150577433277   ,      -0.28768770522487280283      ,
 0.1667005495362078038    ,      -0.19942489488707848544      ,
 0.21972415327989913703   ,      -0.22881235465989116507      ,
 0.22127443424093687363   ,      -0.28818551660073477017      ,
 0.16974639760999779559   ,      -0.3172728852973930036       ,
 0.47097231227512698082   ,      -0.76609833532901661091      ,
 0.41776680871652399629   ,      -0.81053943644750214848      ,
 0.35087618575974693913   ,      -0.78690247409487890096      ,
 0.41761752362251836068   ,      -0.66463137061271926331      ,
 0.46823591547525067469   ,      -0.69863648307979542285      ,
 0.24512644512319123336   ,      -0.56175926273508280939      ,
 0.26527751434517216067   ,      -0.60890857141815202258      ,
 0.32372214728765702496   ,      -0.61299154856259818747      ,
 0.21624576774127043932   ,      -0.66850060888381290791      ,
 0.24419050873825112746   ,      -0.71806905006772714373      ,
 0.35329938133169919157   ,      -0.67449223619497233884      ,
 0.32279948938619495991   ,      -0.71997770023444074283      ,
 0.71987510867636217426   ,       0.18539820118714342434      ,
 0.76698048755068704008   ,       0.044830018924111390832     ,
 0.81048402962147336748   ,       0.10146443396062694575      ,
 0.78848952941684880003   ,       0.16400501089288441192      ,
 0.5943364775536600364    ,       0.0043636878802181715623    ,
 0.66043854401606783      ,      -0.013405848109915305746     ,
 0.70282708520565284616   ,       0.043396700923350517431     ,
-0.18937673799406659625   ,      -0.6594011356034495952       ,
-0.13272895367814505074   ,      -0.67815183437105375219      ,
-0.046428676818177694319  ,      -0.73858471555814964038      ,
-0.11970451452169768303   ,      -0.73632508280739006334      ,
-0.16764676472636938498   ,      -0.79211034018136849966      ,
-0.57876077540056103388   ,       0.51384701413972244666      ,
-0.60945644876080706798   ,       0.55812114117786171263      ,
-0.57456986297398504604   ,       0.61118725034223719828      ,
-0.50921147050057069539   ,       0.52221304881280850019      ,
-0.47740020037192126834   ,       0.57511545248482021098      ,
-0.51206291948508952938   ,       0.61981552697610975411      ,
-0.75519775618522244631   ,       0.74234282198056611435      ,
-0.53629777078279372571   ,       0.90701092314313669362      ,
-0.43769728648420463957   ,       0.95361399771311061713      ,
-0.37536660614728178942   ,       0.90077891886708982838      ,
-0.11235350303727716093   ,       0.46868038061451283705      ,
-0.21660531230386259605   ,       0.46866908885804886564      ,
-0.16623532595523152211   ,       0.49777465039801210844      ,
 0.48006026025330289508   ,      -0.12516455532137979456      ,
 0.53803324841215782737   ,      -0.090870585715418839001     ,
 0.48333071043897329888   ,      -0.0053546372581329106446    ,
 0.54269690000742054625   ,      -0.027054359404713266418     ,
 0.41139832270368331679   ,       0.065015959630098110744     ,
 0.35573068077112313112   ,       0.15450546221504965483      ,
 0.40637780747277957305   ,       0.12317384809607441476      ,
 0.21413399970089533331   ,      -0.05207477023228923585      ,
 0.42968895169693660518   ,      -0.044007233936403995778     ,
 0.43108215310652892027   ,      -0.10000092568894530798      ,
 0.375273112959025823     ,      -0.1353726246477428008       ,
 0.32261598118881351649   ,      -0.10902930803251459357      ,
 0.15253103081904839655   ,      -0.65916226124582355528      ,
 0.096075705256765911444  ,      -0.69782728197701582307      ,
 0.036863224164959011719  ,      -0.66125661779209210511      ,
 0.13861171151157830606   ,      -0.59491045091858063554      ,
 0.03585990312050644363   ,      -0.59378104478146964684      ,
 0.081153064904843266736  ,      -0.56609989863915055608      ,
-0.37143180522924890141   ,       0.55459267350477237102      ,
-0.26814168716021291594   ,       0.49828941900494694295      ,
-0.26420106321515707259   ,       0.56290180741799822339      ,
-0.30990351063921622865   ,       0.58787540720995401511      ,
-0.48155285823757854047   ,       0.48102929106851038954      ,
-0.51075826628173093269   ,       0.42661225885070347408      ,
-0.46753228160141696579   ,       0.38586898244843942374      ,
-0.9556073809899255922    ,      -0.21090309807722298907      ,
-0.89720865518965720042   ,      -0.14281708690214447999      ,
-0.9069467956307973866    ,      -0.30431429677965321501      ,
-0.82945446831607405613   ,      -0.2917818329939688704       ,
-0.80475222318154704393   ,      -0.15806098659171255449      ,
-0.78565862166709188319   ,      -0.21361453398110674673      ,
-0.60936174401576559401   ,      -0.28347843198742500581      ,
-0.50434492758221705078   ,      -0.22557749234461463295      ,
-0.55434731823973171227   ,      -0.19127044632101874999      ,
-0.60607031736951277878   ,      -0.21977636216023474502      ,
-0.66313707756140694016   ,      -0.38557779864525926206      ,
-0.71469542107733108338   ,      -0.42957541362784779082      ,
-0.71708411341752109625   ,      -0.29344600277630589202      ,
-0.66504259102742113718   ,      -0.31954438587961558893      ,
-0.78114024203503296118   ,      -0.40892825253519332618      ,
-0.78162342090920888804   ,      -0.33883225444929493397      ,
 0.897733782288540616     ,       0.5679457206798302904       ,
 0.89163595645743531914   ,       0.6452422360638420118       ,
 0.80839981450083919778   ,       0.65572891611333194994      ,
 0.40810601094573167869   ,       0.23892842661657623382      ,
 0.40822617071049888127   ,       0.29759815828896568624      ,
 0.30544028513635163025   ,       0.81349953840669353422      ,
 0.24029465899102886439   ,       0.77409418507480431959      ,
 0.24247033060844183638   ,       0.70676918444182368351      ,
 0.78337114041755684379   ,       0.28815965904747214976      ,
 0.90903422890413831947   ,       0.40842835039454089552      ,
 0.95365298637669404513   ,       0.32112531170767760758      ,
 0.90915907192589207053   ,       0.23181046373412825257      ,
 0.83278265144294627564   ,       0.23277698587576967082      ,
 0.75954064648915675662   ,       0.81184702481995196788      ,
 0.77607238639968156857   ,       0.70822825929901334074      ,
 0.80353061835132078006   ,       0.76360520518389352063      ,
 0.36652193357275802965   ,       0.77949976619867855643      ,
-0.3216940243780492259    ,       0.061325933913402484732     ,
-0.32683435470394789357   ,       0.11647184857694016513      ,
-0.055926552314867407356  ,       0.15289737811136605572      ,
-0.0025940614313861368179 ,       0.12454892089534941313      ,
-0.0045492197774671212437 ,       0.24220279234955574554      ,
-0.11032664514751129581   ,       0.23817707459265788361      ,
-0.056972212746566275321  ,       0.21120541812430015938      ,
 0.15063152750438513205   ,       0.2169747569762029149       ,
 0.099125780470233612607  ,       0.24572276760885880531      ,
 0.04884913152827041749   ,       0.1549255392384891461       ,
 0.047939633613888289754  ,       0.2142713706797613471       ,
-0.39832826611381122461   ,      -0.23277352135041920467      ,
-0.34613706393166238096   ,      -0.20490726871991141178      ,
-0.45000039139396363908   ,      -0.14361873401894745261      ,
-0.45161503484674597741   ,      -0.1994280071943060062       ,
-0.39757563415207552993   ,      -0.11729161536731309845      ,
-0.34699907542270902461   ,      -0.14523463591216390078      ,
 0.012402304508718259637  ,       0.68017332871451452458      ,
 0.036573314988773274192  ,       0.57716938633982961537      ,
-0.010733493953816610963  ,       0.61561840616487029099      ,
-0.020845995518651971173  ,       0.79129353877286101593      ,
-0.034342300853487141288  ,       0.95502721100330523196      ,
-0.21731002381313033189   ,       0.95147940131889308102      ,
-0.28482761048027605      ,       0.89754963860548520049      ,
-0.11925575592682935433   ,       0.90611663484610593944      ,
-0.10088977848471132603   ,       0.82779805525559113644      ,
-0.11992320868890898877   ,       0.66064294878394191901      ,
-0.098893499206764823306  ,       0.71223606477355660971      ,
-0.18693678362436363938   ,       0.65080258690029990643      ,
-0.14544127797088787779   ,       0.77702081138241130276      ,
 0.20104708195467180243   ,       0.307544060142881992        ,
 0.20151277973786427267   ,       0.24745286129679722187      ,
 0.30433643516797248552   ,       0.24585692941345094198      ,
 0.25304554372409465701   ,       0.21695966080354611716      ,
 0.32494038780191575322   ,      -0.41218184413666292265      ,
 0.27510929223777313979   ,      -0.37856904504332211658      ,
 0.27069718288020089281   ,      -0.50256760335793326799      ,
 0.32054902196025536476   ,      -0.47820647945518574007      ,
 0.11947829997378449363   ,      -0.40607441022936024977      ,
 0.17033551266581778427   ,      -0.37614350388206990727      ,
 0.17231789734527014346   ,      -0.49661032303463104043      ,
 0.12148142816914869746   ,      -0.46856730638583315995      ,
 0.2231921069182837003    ,      -0.46511762659576416645      ,
 0.22321285043419555882   ,      -0.40714370359967611002      ,
 0.52727787514160673332   ,      -0.47057055509757389489      ,
 0.57875375221078884103   ,      -0.49891616638133678974      ,
 0.57815575328395396593   ,      -0.69058111361837370978      ,
 0.52690946411217476353   ,      -0.6623002183421912159       ,
 0.6280039751041529561    ,      -0.65521246488081497095      ,
 0.52643466170839625651   ,      -0.59640869983600375281      ,
 0.62811865245875408981   ,      -0.59157861255655053156      ,
 0.57779562823477659261   ,      -0.56105574278792180731      ,
 0.59694977325145082148   ,       0.066382544309189661647     ,
 0.66552430457053624036   ,       0.15352469384541214681      ,
 0.66039678227112919018   ,       0.091423507213345980849     ,
-0.29679962942858434394   ,      -0.82322378187754663426      ,
-0.23463011193667701604   ,      -0.77824873195997401609      ,
-0.36264476304798048956   ,      -0.78222268810353179358      ,
-0.35110495261341684303   ,      -0.70907952986774247517      ,
-0.29396535310527044382   ,      -0.67554466750017461152      ,
-0.24333564604792687347   ,      -0.70371277581839131177      ,
 0.030630363148564401093  ,      -0.81144535730236233562      ,
-0.031845457242855410018  ,      -0.7995820701127079877       ,
-0.018677364867456049818  ,      -0.95825157149845219262      ,
 0.051454814453011830933  ,      -0.90081977017013770137      ,
-0.12174350454019705614   ,      -0.91081811776129895097      ,
-0.11408714561114900732   ,      -0.84152302924333000078      ,
-0.76407235469607748257   ,       0.79879869155508964607      ,
-0.82917132341773813753   ,       0.83621113125845170089      ,
-0.83401689226174946512   ,       0.8872832797325224119       ,
-0.76879276381324102019   ,       0.91982108512424698432      ,
-0.69698960020489730827   ,       0.8957539694010666631       ,
-0.69711475993174509824   ,       0.82580372430598014688      ,
-0.62983464027026137      ,       0.79997341992720383264      ,
-0.54955752371909249998   ,       0.83138331768020989898      ,
-0.21566940006453605427   ,       0.40714758128782380098      ,
-0.26734503899107014968   ,       0.37643465330299719085      ,
 0.26482474484988360874   ,      -0.022630613131278811551     ,
 0.32011910574469704116   ,      -0.050858362158431376365     ,
 0.36436840287270905181   ,       0.036428433984404338941     ,
 0.37138303610531703258   ,      -0.021207987021118288734     ,
 0.1012320443267295117    ,       0.12585809691062940785      ,
 0.15182829344649892422   ,       0.15645591771924580171      ,
 0.10931111705602165884   ,      -0.052326790839707156        ,
 0.16003318279352179987   ,      -0.022770677723053689423     ,
 0.15677072302771141721   ,       0.036566980378919720918     ,
 0.055611852899480708479  ,      -0.022858490787140306466     ,
 0.052897899457305497251  ,       0.036330536467046516125     ,
 0.10333470384803605802   ,       0.066199894516453069993     ,
-0.37444172591845820142   ,       0.49992400372655049212      ,
-0.42110898702412408179   ,       0.4709296578068598027       ,
-0.31685405527348126098   ,       0.46859434901868085577      ,
-0.31699331934366503649   ,       0.4082610908869560018       ,
-0.36755355371197545589   ,       0.3797766200715542162       ,
-0.41408155074745756075   ,       0.41111553228358826972      ,
-0.55469331272516420039   ,      -0.37562181481447592946      ,
-0.55670368297097927446   ,      -0.31573639138049131025      ,
-0.50340986566721201978   ,      -0.28634136757689687691      ,
-0.45084194074879163638   ,      -0.31763322471100147171      ,
-0.49868848994112918716   ,      -0.40553629202163948841      ,
-0.44813093526852387782   ,      -0.3769427257217594085       ,
 0.4597449447213715068    ,       0.14477944501116335463      ,
 0.46130175447255722387   ,       0.20081469195398071736      ,
 0.50307318169062920088   ,       0.096683420527716168458     ,
 0.55379685303209769121   ,       0.10881508284295515754      ,
 0.66398970459704476088   ,       0.29059003178380876653      ,
 0.45941387861844101836   ,       0.32136996972153819563      ,
 0.56037742994236261485   ,       0.36985905670854374305      ,
 0.46106541395575595388   ,       0.56903638543166690233      ,
 0.81172155560623149295   ,       0.53593052251253681106      ,
 0.76969555997189098573   ,       0.59311066344193930089      ,
 0.71041601639025586667   ,       0.59573663660682496523      ,
 0.30391882847161788561   ,       0.67442480706490959275      ,
 0.41072201797987473171   ,       0.60556015394205386926      ,
 0.41624842501646169834   ,       0.672660081696773271        ,
 0.36282480529061117425   ,       0.70775003548987502899      ,
 0.47460110575983388559   ,       0.70041074450794083006      ,
-0.21267147450787204921   ,       0.064098144758933120468     ,
-0.15725768417895027995   ,       0.03575017901675650589      ,
-0.25735338648218897273   ,      -0.023239917811435726464     ,
-0.26398792015586586279   ,       0.034772002441486676849     ,
-0.15306331458446728599   ,      -0.022946641330723310109     ,
-0.20184257123971219294   ,      -0.052610595841469098843     ,
-0.27252658707113441849   ,       0.14686932420492490592      ,
-0.21606981109724188173   ,       0.12104955185883368995      ,
-0.1640034422483840626    ,       0.20754228712658803757      ,
-0.16292174601336226192   ,       0.15067031919080642322      ,
-0.0049146032545484647988 ,       0.30095271423603103811      ,
 0.046324686186218988482  ,       0.33366062199053353465      ,
 0.043850768951427955555  ,       0.39498586580978600757      ,
-0.0074406063488181321472 ,       0.42059404340742645445      ,
-0.11110143684902397399   ,       0.41229599704224534351      ,
-0.057630910820775906045  ,       0.38617366990571139196      ,
-0.057578824961297271623  ,       0.32785758455356844854      ,
-0.11056787388516094162   ,       0.29607931913545088021      ,
-0.16356587042326739545   ,       0.32196816670086808587      ,
-0.16404734752765176564   ,       0.37986875925551966127      ,
 0.12052859954179991064   ,       0.70908446214027964771      ,
 0.075860940059588086171  ,       0.67509677151727087718      ,
 0.18720242542657458684   ,       0.67533933494350772975      ,
 0.19384948820878242226   ,       0.6125049270555009695       ,
 0.14098646706466133605   ,       0.57952080430110741727      ,
 0.089671744800241662277  ,       0.60836752156610562903      ,
 0.043857656370622645492  ,       0.82103415741448404486      ,
 0.17748803452525516167   ,       0.81281826266232126699      ,
 0.11298988025789348522   ,       0.77923838922611254887      ,
 0.048727328477905507143  ,       0.90644925005441312482      ,
 0.14368490222706950532   ,       0.95190929651965217051      ,
 0.20331338438714832706   ,       0.90007407731593180866      ,
-0.26202768932450398731   ,       0.81305388883859730509      ,
-0.20504336112555807126   ,       0.77068822121769597899      ,
-0.31543587879889850578   ,       0.76390139564928316585      ,
-0.28778215400277817881   ,       0.69433546564156800596      ,
-0.22550915729688961187   ,       0.6960631127251994954       ,
 0.25245564802248932068   ,       0.33695248250936965517      ,
 0.30340578226215381141   ,       0.4259833558448423152       ,
 0.25192096586354084664   ,       0.3974266805200012409       ,
 0.35562626351078657772   ,       0.39254675388588339269      ,
 0.35589803633924393944   ,       0.33279614832486226206      ,
 0.30421223724955964718   ,       0.30575855227318965435      ,
 0.42362533156193954431   ,      -0.47555234942164553713      ,
 0.47473195923224231763   ,      -0.50365493624322732469      ,
 0.37025190726757672977   ,      -0.57045716925016642929      ,
 0.36928886904622770793   ,      -0.51046817638947328266      ,
 0.42470328032609033775   ,      -0.5992399106141834686       ,
 0.47484686977504414473   ,      -0.56735350457507216504      ,
-0.63631544522506600092   ,       0.74537581516164863604      ,
-0.67279316668277810987   ,       0.66022630317675634615      ,
-0.69472096637569480393   ,       0.71475024996590141857      ,
-0.6073345011660084003    ,       0.65549580576780208663      ,
-0.58215614288142403243   ,       0.71034866494666137893      ,
-0.49154886913081169419   ,       0.7927094014537922062       ,
-0.37882762966497890433   ,       0.76312015461977944497      ,
-0.41595843585759012528   ,       0.8155019280706982121       ,
-0.41708947773388921343   ,       0.69410304545788692465      ,
-0.48033809813402728039   ,       0.68004777094081214628      ,
-0.51766668333833854021   ,       0.72627235348579877172      ,
 0.20623477572685230963   ,       0.066457480590474724003     ,
 0.30846770830385639162   ,       0.065972651567881804291     ,
 0.26018798064165093997   ,       0.036563979589511748369     ,
 0.30485050143317432569   ,       0.12589179133255079535      ,
 0.25373100371106294126   ,       0.15671385430033046848      ,
 0.20339500566694634909   ,       0.12668821553662446         ,
 0.5130037404617118213    ,       0.22143636234979632849      ,
 0.51099570484282841321   ,       0.28332190844496435433      ,
 0.56188087797149355307   ,       0.30727707244185425983      ,
 0.61216935610913714161   ,       0.26506017444498691793      ,
 0.61045104457075483051   ,       0.19720142582051858327      ,
 0.56217060205199453904   ,       0.17753277772221795483      ,
 0.56052326575726996172   ,       0.49448954674871065107      ,
 0.66772146833088896756   ,       0.55064710691771179274      ,
 0.51346314882565435855   ,       0.59521625339300943125      ,
 0.52147243359314543465   ,       0.65949068471456395724      ,
 0.61207674069182860244   ,       0.58163216215344060167      ,
 0.56298638741148954168   ,       0.55732047973792153694      ,
 0.40695761651015277538   ,       0.48008015137597292998      ,
 0.45889332117733366845   ,       0.5062899607849169481       ,
 0.40681385153057519899   ,       0.4188951633579889311       ,
 0.50882793439301254868   ,       0.46963889575704859114      ,
 0.50835171046223115443   ,       0.40745029221965589628      ,
 0.45827333226697469781   ,       0.38291636922954030986      ,
 0.79080704849650507171   ,       0.4751715065285688766       ,
 0.8335690292582348393    ,       0.40583888751617619439      ,
 0.78398289612193972076   ,       0.35161914554744561068      ,
 0.30373949217659657052   ,       0.6111598580865565955       ,
 0.35711906195900294803   ,       0.57738515875680251899      ,
 0.24995338064982441928   ,       0.51914674218668499517      ,
 0.24893805709562835671   ,       0.58066982757546403704      ,
 0.30316250703949293444   ,       0.4869031947784466241       ,
 0.35552675326770327713   ,       0.51465158083747164497      ,
 0.68111683966124125789   ,       0.65458191851186986465      ,
 0.70806895514171841466   ,       0.70445528853266559111      ,
 0.62269602729646744699   ,       0.64306509553081536712      ,
 0.58161495878361946232   ,       0.68302784443685071736      ,
 0.53233566000753695935   ,       0.94710210134801808834      ,
 0.44411744345998077632   ,       0.9030331797110090486       ,
 0.43613421227836174365   ,       0.81766262330543548753      ,
 0.490789764739587131     ,       0.77366355540779940814      ,
-0.2738029103632286243    ,       0.20266985971450834914      ,
-0.32442724448824905581   ,       0.28577065886765701253      ,
-0.32764520819620129854   ,       0.22753079870814177377      ,
-0.26990614609251006861   ,       0.31743335490551066735      ,
-0.2177490300615915475    ,       0.29024569033568581311      ,
-0.21842783062435791597   ,       0.23372205530419867814      ,
 0.6697588826532162587    ,       0.4921650257308919918       ,
 0.72333351904091680584   ,       0.4571973844453540714       ,
 0.61198142147581036099   ,       0.39787726147463559068      ,
 0.61165103335993631362   ,       0.46031914797740985934      ,
 0.66530521799284902951   ,       0.36082513454676795606      ,
 0.71854946626467552928   ,       0.38829937976400441535      ,
 0.69212494265906077118   ,       0.80956450900771315116      ,
 0.66811148326326164071   ,       0.75754971860530717631      ,
 0.65765442275206631439   ,       0.88772187742759778306      ,
 0.58968709714554645718   ,       0.88542273820276362617      ,
 0.60007829926993638825   ,       0.7476390974905468001       ,
 0.55612443305921555048   ,       0.79735474866811861805      
};

#define NR_QNODES_D10 (25)

static const matlib_real xi10[2*NR_QNODES_D10] = 
{
    -9.653080397659108e-03,    -9.806938392046819e-01, 
    -9.653080397659108e-03,    -9.653080397658886e-03,
    -9.806938392046820e-01,    -9.653080397658553e-03,
    -9.617211695143177e-01,    -9.617211695143172e-01,
     9.234423390286350e-01,    -9.617211695143179e-01,
    -9.617211695143169e-01,     9.234423390286350e-01,
    -7.325304897982617e-01,    -9.305527590353451e-01,
     6.630832488336067e-01,    -7.325304897982617e-01,
    -9.305527590353451e-01,     6.630832488336074e-01,
     6.630832488336067e-01,    -9.305527590353451e-01,
    -7.325304897982616e-01,     6.630832488336069e-01,
    -9.305527590353454e-01,    -7.325304897982612e-01,
    -3.333333333333335e-01,    -3.333333333333331e-01,
    -3.466137274373262e-01,    -9.248345453176166e-01,
     2.714482727549430e-01,    -3.466137274373262e-01,
    -9.248345453176166e-01,     2.714482727549430e-01,
     2.714482727549428e-01,    -9.248345453176166e-01,
    -3.466137274373262e-01,     2.714482727549430e-01,
    -9.248345453176168e-01,    -3.466137274373257e-01,
    -6.310299746295072e-01,    -6.310299746295067e-01,
     2.620599492590139e-01,    -6.310299746295071e-01,
    -6.310299746295067e-01,     2.620599492590143e-01,
    -1.435303581125623e-01,    -7.129392837748754e-01,
    -1.435303581125623e-01,    -1.435303581125622e-01,
    -7.129392837748755e-01,    -1.435303581125620e-01
};

static const matlib_real qwa10[NR_QNODES_D10] = 
{
     1.958518099683661e-02, 
     1.958518099683661e-02,
     1.958518099683661e-02,
     1.277071846023731e-02,
     1.277071846023731e-02,
     1.277071846023731e-02,
     5.792456292651268e-02,
     5.792456292651268e-02,
     5.792456292651268e-02,
     5.792456292651268e-02,
     5.792456292651268e-02,
     5.792456292651268e-02,
     1.672297487479479e-01,
     7.747809817203781e-02,
     7.747809817203781e-02,
     7.747809817203781e-02,
     7.747809817203781e-02,
     7.747809817203781e-02,
     7.747809817203781e-02,
     1.572675394927546e-01,
     1.572675394927546e-01,
     1.572675394927546e-01,
     1.504946559370880e-01,
     1.504946559370880e-01,
     1.504946559370880e-01
};


static const fem2d_cc nodes = { .len = SIZE_p/2, 
                                .elem_p = (matlib_real*) p };

static const fem2d_cc cen = { .len = NR_DOMAINS, 
                              .elem_p = (matlib_real*)ca };

static const fem2d_cc xi = { .len = NR_QNODES, 
                             .elem_p = (matlib_real*)xi4 };

static const fem2d_cc xi_10 = { .len = NR_QNODES_D10, 
                             .elem_p = (matlib_real*)xi10 };
/*============================================================================*/

int init_suite(void)
{
      return 0;
}
int clean_suite(void)
{
      return 0;
}              
/*============================================================================*/
static fem2d_err cyclic_permutation
(
    const matlib_index *const ia, 
    const matlib_index len,
    const matlib_index p_step,
         matlib_index* cia
)
{
    int i;
    fem2d_err error = FEM2D_SUCCESS;

    if (p_step == 0)
    {
        for (i = 0; i < 3*len; i+=3)
        {
            cia[0 + i] = ia[0 + i];
            cia[1 + i] = ia[1 + i];
            cia[2 + i] = ia[2 + i];
        }
    }
    if (p_step == 1)
    {
        for (i = 0; i < 3*len; i+=3)
        {
            cia[0 + i] = ia[2 + i];
            cia[1 + i] = ia[0 + i];
            cia[2 + i] = ia[1 + i];
        }
    }
    else if (p_step == 2)
    {
        for (i = 0; i < 3*len; i+=3)
        {
            cia[0 + i] = ia[1 + i];
            cia[1 + i] = ia[2 + i];
            cia[2 + i] = ia[0 + i];
        }
    }
    else
    {
        error = FEM2D_FAILURE;
    }
    return error;
}

void sort_vertices
(
    matlib_index nr_domains,
    const matlib_index *ia, 
    matlib_index *sia
)
{
    debug_enter( "Nr domains: %d", nr_domains);

    matlib_real *vert1, *vert2, *vert3;
    matlib_index i, index1, index2, index3, pos1, pos2, pos3;

    for ( i = 0; i < FEM2D_NV * nr_domains; i += FEM2D_NV)
    {

        /* Vertex indices are sorted in the increasing order
         * */ 
        index1 = ia[i + FEM2D_INDEX_V1];
        pos1   = FEM2D_INDEX_V1;
        if (index1 > ia[i + FEM2D_INDEX_V2])
        {
            index1 = ia[i + FEM2D_INDEX_V2];
            pos1 = FEM2D_INDEX_V2;
        }
        if (index1 > ia[i + FEM2D_INDEX_V3])
        {
            index1 = ia[i + FEM2D_INDEX_V3];
            pos1 = FEM2D_INDEX_V3;
        }
        pos2   = ((pos1 + 1) % FEM2D_NV);
        pos3   = ((pos1 + 2) % FEM2D_NV);
        index2 = ia[i + pos2];
        if (index2 > ia[i + pos3])
        {
            index2 = ia[i + pos3];
            index3 = ia[i + pos2];
        }
        else
        {
            index3 = ia[i + pos3];
        }
        sia[i + FEM2D_INDEX_V1] = index1;
        sia[i + FEM2D_INDEX_V2] = index2;
        sia[i + FEM2D_INDEX_V3] = index3;
    }
}
/*============================================================================*/

void test_create_vp(void)
{
    fem2d_ea ea;
    fem2d_create_ea(nodes, ia, NR_DOMAINS, &ea);
    fem2d_create_vp(&ea);

    fem2d_vpinfo_t test_info;
    test_info.option = FEM2D_TEST_PASSED;
    fem2d_check_vp(ea, &test_info);
    fem2d_write_vpinfo(&test_info, ea, "vpinfo.txt");

    fem2d_free_vpinfo(&test_info);
    fem2d_free_ea(ea);
}
void test_create_vp1(void)
{
    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    fem2d_ea ea;
    fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    fem2d_create_vp(&ea);

    fem2d_vpinfo_t test_info;
    test_info.option = FEM2D_TEST_PASSED;

    fem2d_check_vp(ea, &test_info);
    fem2d_write_vpinfo(&test_info, ea, "vpinfo2.txt");

    fem2d_free_vpinfo(&test_info);

    matlib_free(my_nodes.elem_p);
    fem2d_free_ea(ea);
}

/*============================================================================*/
void test_create_ia(void)
{

    fem2d_ea ea;
    fem2d_create_ea(nodes, ia, NR_DOMAINS, &ea);

    matlib_index ia_tmp[SIZE_ia];
    fem2d_create_ia(ea, ia_tmp);
    
    matlib_real err1, err2 = 0;
    for (matlib_index i=0; i< SIZE_ia; i++)
    {
        err2 += ((ia[i] - ia_tmp[i]) * (ia[i] - ia_tmp[i]));
    }

    err1 = sqrt(err2/SIZE_ia);
    debug_body("Relative error: %0.16g", err1);
    CU_ASSERT_TRUE(err1 < TOL);
}


/*============================================================================*/
void test_centroid_a(void)
{
    fem2d_ea ea0;
    fem2d_create_ea(nodes, ia, NR_DOMAINS, &ea0);
    
    fem2d_cc cen0;
    fem2d_create_cc(NR_DOMAINS, &cen0);

    fem2d_centroid(ea0, cen0);
    
    matlib_real err = 0;
    int i;
    for (i = 0; i< 2*NR_DOMAINS; i+=2)
    {
        err += (   pow(cen0.elem_p[i]   - cen.elem_p[i]  , 2) 
                 + pow(cen0.elem_p[i+1] - cen.elem_p[i+1], 2));
              
    }
    CU_ASSERT_TRUE(sqrt(err/NR_DOMAINS)<TOL);
}

void test_centroid_b(void)
{

    matlib_index cia1[SIZE_ia], cia2[SIZE_ia];
    cyclic_permutation(ia, NR_DOMAINS, 1, cia1);
    cyclic_permutation(ia, NR_DOMAINS, 2, cia2);

    fem2d_ea ea0, ea1, ea2;
    fem2d_create_ea(nodes,   ia, NR_DOMAINS, &ea0);
    fem2d_create_ea(nodes, cia1, NR_DOMAINS, &ea1);
    fem2d_create_ea(nodes, cia2, NR_DOMAINS, &ea2);
    
    fem2d_cc cen0, cen1, cen2;
    fem2d_create_cc(NR_DOMAINS, &cen0);
    fem2d_create_cc(NR_DOMAINS, &cen1);
    fem2d_create_cc(NR_DOMAINS, &cen2);

    fem2d_centroid(ea0, cen0);
    fem2d_centroid(ea1, cen1);
    fem2d_centroid(ea2, cen2);
    
    matlib_real err = 0;
    matlib_index i;
    for (i = 0; i< 2*NR_DOMAINS; i+=2)
    {
        err += (   pow(   cen0.elem_p[i] - cen1.elem_p[i]  , 2)     
                 + pow(   cen1.elem_p[i] - cen2.elem_p[i]  , 2) 
                 + pow( cen0.elem_p[i+1] - cen1.elem_p[i+1], 2) 
                 + pow( cen1.elem_p[i+1] - cen2.elem_p[i+1], 2));
              
    }
    matlib_real err1 =  sqrt(err/(2*NR_DOMAINS));
    CU_ASSERT_TRUE( err1 < TOL);
}

/*============================================================================*/
void test_refbasis(void)
{

    matlib_xm vphi;
    
    fem2d_refbasis(xi, &vphi);
    
    int i;
    
    matlib_real err = 0, err1;

    for(i = 0; i < xi.len; i++)
    {
        err1 =  (   vphi.elem_p[i] 
                  + vphi.elem_p[xi.len + i] 
                  + vphi.elem_p[2*xi.len + i] 
                  - 1.0);
        err += (err1 * err1);
        
    }
    CU_ASSERT_TRUE(sqrt(err/xi.len) < TOL);
}

void test_ref2mesh(void)
{
    matlib_index cia1[SIZE_ia], cia2[SIZE_ia];
    cyclic_permutation(ia, NR_DOMAINS, 1, cia1);
    cyclic_permutation(ia, NR_DOMAINS, 2, cia2);

    fem2d_ea ea0, ea1, ea2;
    fem2d_create_ea(nodes,   ia, NR_DOMAINS, &ea0);
    fem2d_create_ea(nodes, cia1, NR_DOMAINS, &ea1);
    fem2d_create_ea(nodes, cia2, NR_DOMAINS, &ea2);

    matlib_xm vphi;
    fem2d_refbasis(xi, &vphi);

    fem2d_cc x0, x1, x2;
    fem2d_ref2mesh(ea0, vphi, &x0);
    fem2d_ref2mesh(ea1, vphi, &x1);
    fem2d_ref2mesh(ea2, vphi, &x2);
    
    matlib_index i, j; 
    matlib_real err = 0, err1, err2, cent1, cent2;

    for (i = 0; i < ea0.len; i++ )
    {
        cent1 = ca[2 * i + 0];
        cent2 = ca[2 * i + 1];

        for (j = 0; j < (2 * xi.len); j+=2 )
        {
            err1 = (  x0.elem_p[2 * i * xi.len + j + 0] 
                    + x1.elem_p[2 * i * xi.len + j + 0] 
                    + x2.elem_p[2 * i * xi.len + j + 0]
                    - 3.0 *  cent1); 
            err2 = (  x0.elem_p[2 * i * xi.len + j + 1] 
                    + x1.elem_p[2 * i * xi.len + j + 1] 
                    + x2.elem_p[2 * i * xi.len + j + 1]
                    - 3.0 *  cent2); 

            err += (err1 * err1 + err2 * err2);

            debug_body("domain: %d, error: %0.16f", i,  err1 + err2);
        }   
    }
    CU_ASSERT_TRUE(sqrt(err/ea0.len) < TOL);
}

/*============================================================================*/
fem2d_err poly_xfunc
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = (ptr[0] - 2.0*ptr[1]);
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}

fem2d_err poly_zfunc
(
    fem2d_cc nodes_tmp, 
    matlib_zv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_complex* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p +2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = (ptr[0] + I * ptr[1]);
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}

fem2d_err poly_xfunc1
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p +2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = (ptr[0] + 2.0 * ptr[1]);
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}


fem2d_err poly_zfunc1
(
    fem2d_cc nodes_tmp, 
    matlib_zv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_complex* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p +2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = (ptr[0] + 2.0 * I *ptr[1]);
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}


void test_xinterp(void)
{

    fem2d_ea ea;
    fem2d_create_ea(nodes, ia, NR_DOMAINS, &ea);
    fem2d_create_vp(&ea);

    matlib_xv u_nodes;
    matlib_create_xv( nodes.len, &u_nodes, MATLIB_COL_VECT);
    poly_xfunc(nodes, u_nodes);
    //DEBUG_PRINT_XV(u_nodes, "%s:", "u_nodes");

    matlib_xm vphi;
    fem2d_refbasis(xi, &vphi);
    //DEBUG_PRINT_XM( vphi, "%s:", "vphi");

    fem2d_cc x_interp;
    fem2d_ref2mesh(ea, vphi, &x_interp);

    matlib_xv u_interp;
    matlib_xv u_exact;

    matlib_create_xv( x_interp.len, &u_interp, MATLIB_COL_VECT);
    matlib_create_xv( x_interp.len, &u_exact , MATLIB_COL_VECT);

    fem2d_xinterp( ea, u_nodes, vphi, u_interp);
    poly_xfunc(x_interp, u_exact);

    BEGIN_DEBUG
        for (matlib_index i = 0; i < u_interp.len; i++)
        {
            debug_print( "u[%d]-> diff: %0.16f",
                         i, fabs(u_interp.elem_p[i]-u_exact.elem_p[i]));
        }
    END_DEBUG
 
    matlib_real norm_actual = matlib_xnrm2(u_exact);
    debug_body("norm: %0.16g", norm_actual);
    matlib_xaxpy(-1.0, u_exact, u_interp);
    matlib_real e_relative = matlib_xnrm2(u_interp)/norm_actual;

    debug_exit("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative<TOL);

}

void test_zinterp_a(void)
{

    fem2d_ea ea;
    fem2d_create_ea(nodes, ia, NR_DOMAINS, &ea);
    fem2d_create_vp(&ea);

    matlib_zv u_nodes;
    matlib_create_zv( nodes.len, &u_nodes, MATLIB_COL_VECT);
    poly_zfunc(nodes, u_nodes);
    //DEBUG_PRINT_ZV(u_nodes, "%s:", "u_nodes");

    matlib_xm vphi;
    fem2d_refbasis(xi, &vphi);
    //DEBUG_PRINT_XM( vphi, "%s:", "vphi");

    fem2d_cc x_interp;
    fem2d_ref2mesh(ea, vphi, &x_interp);

    matlib_zv u_interp;
    matlib_zv u_exact;

    matlib_create_zv( NR_DOMAINS * NR_QNODES, &u_interp, MATLIB_COL_VECT);
    matlib_create_zv( NR_DOMAINS * NR_QNODES, &u_exact , MATLIB_COL_VECT);

    fem2d_zinterp( ea, u_nodes, vphi, u_interp);
    poly_zfunc(x_interp, u_exact);

    BEGIN_DEBUG
        for (matlib_index i = 0; i < u_interp.len; i++)
        {
            debug_print( "u[%d]-> diff: %0.16f%+0.16fi", i, 
                         creal(u_interp.elem_p[i])-creal(u_exact.elem_p[i]),
                         cimag(u_interp.elem_p[i])-cimag(u_exact.elem_p[i]));
        }
    END_DEBUG
 
    matlib_real norm_actual = matlib_znrm2(u_exact);
    debug_body("norm: %0.16g", norm_actual);
    matlib_zaxpy(-1.0, u_exact, u_interp);
    matlib_real e_relative = matlib_znrm2(u_interp)/norm_actual;

    debug_exit("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative<TOL);

}


fem2d_err test_func_zinterp(void)
{

    fem2d_err error = FEM2D_SUCCESS;

    matlib_index mcnt = 0;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(nodes, ia, NR_DOMAINS, &ea);
    err_check( (error == FEM2D_FAILURE), clean_up, "%s", 
               "Creation of element array failed!");
    fem2d_create_vp(&ea);
    mcnt++; /* 1 */ 

    /* u_nodes: field values at nodes */ 
    matlib_zv u_nodes;
    error = matlib_create_zv( nodes.len, &u_nodes, MATLIB_COL_VECT);
    err_check( (error == FEM2D_FAILURE), clean_up, "%s", 
               "Memory allocation for field values at nodes failed!");
    mcnt++; /* 2 */ 
    error = poly_zfunc(nodes, u_nodes);
    err_check( (error == FEM2D_FAILURE), clean_up, "%s", 
               "Calculation of field at nodes failed!");
    DEBUG_PRINT_ZV(u_nodes, "%s:", "u_nodes");

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    matlib_xm vphi;
    error = fem2d_refbasis(xi, &vphi);
    err_check( (error == FEM2D_FAILURE), clean_up, "%s", 
               "Creation of basis function-value matrix failed!");
    mcnt++; /* 3 */ 
    DEBUG_PRINT_XM( vphi, "%s:", "vphi");

    /* x_interp: mesh points for interpolation 
     * */ 
    fem2d_cc x_interp;
    error = fem2d_ref2mesh(ea, vphi, &x_interp);
    err_check( (error == FEM2D_FAILURE), clean_up, "%s", 
               "Creation of interpolation mesh-point array failed!");
    mcnt++; /* 4 */ 

    matlib_zv u_interp;
    error = matlib_create_zv( NR_DOMAINS * NR_QNODES, &u_interp, MATLIB_COL_VECT);
    err_check( (error == FEM2D_FAILURE), clean_up, "%s", 
               "Memory allocation for interpolation failed!");
    mcnt++; /* 5 */ 

    matlib_zv u_exact;
    error = matlib_create_zv( NR_DOMAINS * NR_QNODES, &u_exact , MATLIB_COL_VECT);
    //error = FEM2D_FAILURE;
    err_check( (error == FEM2D_FAILURE), clean_up, "%s", 
               "Memory allocation for interpolation failed!");
    mcnt++; /* 6 */ 

    error = fem2d_zinterp( ea, u_nodes, vphi, u_interp);
    err_check( (error == FEM2D_FAILURE), clean_up, "%s", 
               "Interpolation failed!");

    error = poly_zfunc(x_interp, u_exact);
    err_check( (error == FEM2D_FAILURE), clean_up, "%s", 
               "Calculation of exact field values failed!");
    BEGIN_DEBUG
        for (matlib_index i = 0; i < u_interp.len; i++)
        {
            debug_print( "u[%d]-> diff: %0.16f%+0.16fi",
                         i, 
                         creal(u_interp.elem_p[i])-creal(u_exact.elem_p[i]),
                         cimag(u_interp.elem_p[i])-cimag(u_exact.elem_p[i]));
        
        }
    END_DEBUG
 
    matlib_real norm_actual = matlib_znrm2(u_exact);
    matlib_zaxpy(-1.0, u_exact, u_interp);
    matlib_real e_relative = matlib_znrm2(u_interp)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    err_check( (e_relative > TOL), clean_up, "%s", 
               "Tolerance test failed!");
    
    
    matlib_free(u_exact.elem_p);
    matlib_free(u_interp.elem_p);
    matlib_free(x_interp.elem_p);
    matlib_free(vphi.elem_p);
    matlib_free(u_nodes.elem_p);
    fem2d_free_ea(ea);
    debug_exit( "Relative error: %0.16g, Exit Status: %s", 
                e_relative, "SUCCESS");
    return FEM2D_SUCCESS;

clean_up:
    if(mcnt==6)
    {
        matlib_free(u_interp.elem_p);
        mcnt --;
    }
    if(mcnt==5)
    {
        matlib_free(u_exact.elem_p);
        mcnt --;
    }
    if(mcnt==4)
    {
        matlib_free(x_interp.elem_p);
        mcnt--;
    }
    if(mcnt==3)
    {
        matlib_free(vphi.elem_p);
        mcnt--;
    }
    if(mcnt==2)
    {
        matlib_free(u_nodes.elem_p);
        mcnt--;
    }
    if(mcnt==1)
    {
        fem2d_free_ea(ea);
    }
    debug_exit( "Exit Status: %s", "FAILURE");
    return FEM2D_FAILURE;
}
void test_zinterp_b(void)
{
    fem2d_err error = test_func_zinterp();
    CU_ASSERT_TRUE(error == FEM2D_SUCCESS);

}
/*============================================================================*/
/* exact value of the norm of exp(-a*x^2) : sqrt(pi/2a)
 * */ 
fem2d_err Gaussian_xfunc
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = exp(-(ptr[0]*ptr[0] + ptr[1] * ptr[1]));
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}

fem2d_err Gaussian_zfunc
(
    fem2d_cc nodes_tmp, 
    matlib_zv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_complex* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = cexp(-(1.0 + I*1.0) * (ptr[0]*ptr[0] + ptr[1] * ptr[1]));
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}
fem2d_err Gaussian_zfunc2
(
    fem2d_cc nodes_tmp, 
    matlib_zv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_complex* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr =   cexp(-(1.0 + I*1.0)* (ptr[0]*ptr[0] + ptr[1] * ptr[1])) 
                * cexp(I*2.0*(ptr[0]+ptr[1]));
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}

fem2d_err poly_odd_xfunc
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = pow(ptr[0], 3) * ptr[1];
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}

fem2d_err poly_odd_zfunc
(
    fem2d_cc nodes_tmp, 
    matlib_zv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_complex* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = pow(ptr[0], 3) * ptr[1] * cexp(I*2.0*(ptr[0]+ptr[1]));
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}

/*============================================================================*/
/* Test L2-norm 
 * */ 

void test_xnormL2(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);

    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_xv u_qnodes;
    error = matlib_create_xv( nr_domains * xi_D.len, &u_qnodes , MATLIB_COL_VECT);

    error = Gaussian_xfunc(x_qnodes, u_qnodes);

    matlib_real norm = fem2d_xnormL2(ea, u_qnodes, quadW);
    matlib_real norm_actual = sqrt(M_PI/2);

    matlib_real e_relative = fabs(norm - norm_actual)/norm_actual;
    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 8.0*TOL);

    matlib_free(x_qnodes.elem_p);
    matlib_free(u_qnodes.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);
}

void test_znormL2(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);

    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_zv u_qnodes;
    error = matlib_create_zv( nr_domains * xi_D.len, &u_qnodes , MATLIB_COL_VECT);

    error = Gaussian_zfunc(x_qnodes, u_qnodes);

    matlib_real norm = fem2d_znormL2(ea, u_qnodes, quadW);
    matlib_real norm_actual = sqrt(M_PI/2);

    matlib_real e_relative = fabs(norm - norm_actual)/norm_actual;
    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 8.0*TOL);

    matlib_free(x_qnodes.elem_p);
    matlib_free(u_qnodes.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);
}

/*============================================================================*/
/* Comput inner product of f and g define by
 *
 * f(x,y) = x^3 y
 * g(x,y) = exp(-a(x^2+y^2))
 * 
 * Exact value equals: 0
 *
 * */ 

void test_xiprod(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);

    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);

    matlib_xv u_qnodes;
    error = matlib_create_xv( nr_domains * xi_D.len, &u_qnodes , MATLIB_COL_VECT);

    error = Gaussian_xfunc(x_qnodes, u_qnodes);

    matlib_xv v_qnodes;
    error = matlib_create_xv( nr_domains * xi_D.len, &v_qnodes , MATLIB_COL_VECT);

    error = poly_odd_xfunc(x_qnodes, v_qnodes);

    matlib_real iprod = fem2d_xiprod(ea, u_qnodes, v_qnodes, quadW);
    debug_body("Inner product: %0.16f", iprod);

    CU_ASSERT_TRUE(fabs(iprod) < TOL);

    matlib_free(v_qnodes.elem_p);
    matlib_free(u_qnodes.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);

}

void test_ziprod(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);

    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);

    matlib_zv u_qnodes;
    error = matlib_create_zv( nr_domains * xi_D.len, &u_qnodes , MATLIB_COL_VECT);

    error = Gaussian_zfunc2(x_qnodes, u_qnodes);

    matlib_zv v_qnodes;
    error = matlib_create_zv( nr_domains * xi_D.len, &v_qnodes , MATLIB_COL_VECT);

    error = poly_odd_zfunc(x_qnodes, v_qnodes);

    matlib_complex iprod = fem2d_ziprod(ea, u_qnodes, v_qnodes, quadW);
    debug_body("Inner product: %0.16f%+0.16fi", iprod);

    CU_ASSERT_TRUE(cabs(iprod) < TOL);

    matlib_free(v_qnodes.elem_p);
    matlib_free(u_qnodes.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);

}

/*============================================================================*/
void test_quadP(void)
{
    matlib_index m;
    matlib_index n;
    matlib_real e_relative;
    /* quadW: quadrature weights */ 
    matlib_index D;
    matlib_xv quadW;
    fem2d_cc xi_D;


    for (D = 2; D < 51; D++)
    {
        m = (matlib_index) (D/2); 
        n = D - m - 1;
        fem2d_symq(D, &xi_D, &quadW);

        e_relative = fem2d_check_quadP(xi_D, quadW, m, n);
        debug_exit( "D: %d, Relative error: %0.16f",
                    D, e_relative);
        if(isnan(e_relative))
        {
            CU_ASSERT_TRUE(false);
        }
        else
        {
            CU_ASSERT_TRUE(e_relative<TOL);
        }
        matlib_free(xi_D.elem_p);
        matlib_free(quadW.elem_p);
    }
}
/* 
 * Project f(x,y) onto fem-basis
 * Use a linear function g(x,y) = x+y which can be exactly represented by
 * fem-basis and compute inner product. Compare with exact result.
 *
 * */ 

void test_xprj(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);

    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);

    matlib_xv u_qnodes;
    error = matlib_create_xv( nr_domains * xi_D.len, &u_qnodes , MATLIB_COL_VECT);
    
    /* f(x,y) = exp(-5 *(x^2+y^2))*/ 
    error = Gaussian_xfunc(x_qnodes, u_qnodes);

    matlib_xv v_nodes;
    error = matlib_create_xv( my_nodes.len, &v_nodes , MATLIB_COL_VECT);

    /* g(x,y) = x - 2y */ 
    error = poly_xfunc(my_nodes, v_nodes);

    matlib_xv u_prj;
    error = matlib_create_xv( my_nodes.len, &u_prj , MATLIB_COL_VECT);

    matlib_xm quadP;
    error = fem2d_quadP( vphi, quadW, &quadP );

    error = fem2d_xprj(ea, u_qnodes, quadP, u_prj);
    /* find inner product by using the projection 
     * */
    matlib_real iprod = 0;
    for (matlib_index i = 0; i < my_nodes.len; i++)
    {
        iprod += (u_prj.elem_p[i] * v_nodes.elem_p[i]);
    }

    debug_body("Inner product: %0.16g", iprod);
    CU_ASSERT_TRUE(fabs(iprod)<TOL);

    matlib_free(quadP.elem_p);
    matlib_free(u_prj.elem_p);
    matlib_free(u_qnodes.elem_p);
    matlib_free(v_nodes.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);
}


void test_zprj(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);

    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);

    matlib_zv u_qnodes;
    error = matlib_create_zv( nr_domains * xi_D.len, &u_qnodes , MATLIB_COL_VECT);
    
    /* f(x,y) = exp(-5 *(x^2+y^2))*/ 
    error = Gaussian_zfunc(x_qnodes, u_qnodes);

    matlib_zv v_nodes;
    error = matlib_create_zv( my_nodes.len, &v_nodes , MATLIB_COL_VECT);

    /* g(x,y) = x +iy */ 
    error = poly_zfunc(my_nodes, v_nodes);

    matlib_zv u_prj;
    error = matlib_create_zv( my_nodes.len, &u_prj , MATLIB_COL_VECT);

    matlib_xm quadP;
    error = fem2d_quadP( vphi, quadW, &quadP );

    error = fem2d_zprj(ea, u_qnodes, quadP, u_prj);
    /* find inner product by using the projection 
     * */
    matlib_complex iprod = 0;
    for (matlib_index i = 0; i < my_nodes.len; i++)
    {
        iprod += (u_prj.elem_p[i] * conj(v_nodes.elem_p[i]));
    }

    debug_body("Inner product: %0.16g%+0.16gi", iprod);
    CU_ASSERT_TRUE(cabs(iprod)<TOL);

    matlib_free(quadP.elem_p);
    matlib_free(u_prj.elem_p);
    matlib_free(u_qnodes.elem_p);
    matlib_free(v_nodes.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);
}
/*============================================================================*/

/* 
 * Use a smaller tolerance for the NB functions! This can only be lowered if the
 * mesh is further refined.
 *
 * */ 
#define TOL_NB (1e-5)
void test_NB_xnormL2(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);
    
    matlib_xv u_nodes;
    error = matlib_create_xv( my_nodes.len, &u_nodes , MATLIB_COL_VECT);

    /* f(x,y) = exp(-5(x^2+y^2))*/ 
    error = Gaussian_xfunc(my_nodes, u_nodes);

    matlib_real norm = fem2d_NB_xnormL2(ea, u_nodes);
    matlib_real norm_actual = sqrt(M_PI/2);

    matlib_real e_relative = fabs(norm - norm_actual)/norm_actual;
    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 2.0*TOL_NB);

    matlib_free(u_nodes.elem_p);
    fem2d_free_ea(ea);
}

void test_NB_xiprod(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    matlib_xv u_nodes;
    error = matlib_create_xv( my_nodes.len, &u_nodes , MATLIB_COL_VECT);

    /* f(x,y) = exp(-5(x^2+y^2))*/ 
    error = Gaussian_xfunc(my_nodes, u_nodes);

    matlib_xv v_nodes;
    error = matlib_create_xv( my_nodes.len, &v_nodes , MATLIB_COL_VECT);

    /* f(x,y) = exp(-5(x^2+y^2))*/ 
    error = poly_odd_xfunc(my_nodes, v_nodes);

    matlib_real iprod = fem2d_NB_xiprod(ea, u_nodes, v_nodes);
    debug_body("Inner product: %0.16g", iprod);

    CU_ASSERT_TRUE(fabs(iprod) < TOL);

    matlib_free(v_nodes.elem_p);
    matlib_free(u_nodes.elem_p);

    fem2d_free_ea(ea);
}

void test_NB_xprj(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    matlib_xv u_nodes;
    error = matlib_create_xv( my_nodes.len, &u_nodes , MATLIB_COL_VECT);

    /* f(x,y) = exp(-5(x^2+y^2))*/ 
    error = Gaussian_xfunc(my_nodes, u_nodes);

    matlib_xv v_nodes;
    error = matlib_create_xv( my_nodes.len, &v_nodes , MATLIB_COL_VECT);

    error = poly_odd_xfunc(my_nodes, v_nodes);

    matlib_xv u_prj;
    error = matlib_create_xv( my_nodes.len, &u_prj , MATLIB_COL_VECT);

    error = fem2d_NB_xprj(ea, u_nodes, u_prj);
    /* find inner product by using the projection 
     * */
    matlib_real iprod = 0;
    for (matlib_index i = 0; i < my_nodes.len; i++)
    {
        iprod += (u_prj.elem_p[i] * v_nodes.elem_p[i]);
    }

    debug_body("Inner product: %0.16g", iprod);

    CU_ASSERT_TRUE(fabs(iprod) < TOL);

    matlib_free(v_nodes.elem_p);
    matlib_free(u_nodes.elem_p);

    fem2d_free_ea(ea);
}

/*  Complex version */

void test_NB_znormL2(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);
    
    matlib_zv u_nodes;
    error = matlib_create_zv( my_nodes.len, &u_nodes , MATLIB_COL_VECT);

    /* f(x,y) = exp(-5(x^2+y^2))*/ 
    error = Gaussian_zfunc(my_nodes, u_nodes);

    matlib_real norm = fem2d_NB_znormL2(ea, u_nodes);
    matlib_real norm_actual = sqrt(M_PI/2);

    matlib_real e_relative = fabs(norm - norm_actual)/norm_actual;
    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 2.0*TOL_NB);

    matlib_free(u_nodes.elem_p);
    fem2d_free_ea(ea);
}

void test_NB_ziprod(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    matlib_zv u_nodes;
    error = matlib_create_zv( my_nodes.len, &u_nodes , MATLIB_COL_VECT);

    /* f(x,y) = exp(-5(x^2+y^2))*/ 
    error = Gaussian_zfunc2(my_nodes, u_nodes);

    matlib_zv v_nodes;
    error = matlib_create_zv( my_nodes.len, &v_nodes , MATLIB_COL_VECT);

    error = poly_odd_zfunc(my_nodes, v_nodes);

    matlib_complex iprod = fem2d_NB_ziprod(ea, u_nodes, v_nodes);
    debug_body("Inner product: %0.16g%+0.16gi", iprod);

    CU_ASSERT_TRUE(cabs(iprod) < TOL);

    matlib_free(v_nodes.elem_p);
    matlib_free(u_nodes.elem_p);

    fem2d_free_ea(ea);
}

void test_NB_zprj(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    matlib_zv u_nodes;
    error = matlib_create_zv( my_nodes.len, &u_nodes , MATLIB_COL_VECT);

    error = Gaussian_zfunc2(my_nodes, u_nodes);

    matlib_zv v_nodes;
    error = matlib_create_zv( my_nodes.len, &v_nodes , MATLIB_COL_VECT);

    error = poly_odd_zfunc(my_nodes, v_nodes);

    matlib_zv u_prj;
    error = matlib_create_zv( my_nodes.len, &u_prj , MATLIB_COL_VECT);

    error = fem2d_NB_zprj(ea, u_nodes, u_prj);
    /* find inner product by using the projection 
     * */
    matlib_complex iprod = 0;
    for (matlib_index i = 0; i < my_nodes.len; i++)
    {
        iprod += (u_prj.elem_p[i] * conj(v_nodes.elem_p[i]));
    }

    debug_body("Inner product: %0.16g%+0.16gi", iprod);

    CU_ASSERT_TRUE(cabs(iprod) < TOL);

    matlib_free(v_nodes.elem_p);
    matlib_free(u_nodes.elem_p);

    fem2d_free_ea(ea);
}


/*============================================================================*/
void test_quadM(void)
{
    matlib_index m;
    matlib_index n;
    matlib_real e_relative;
    /* quadW: quadrature weights */ 
    matlib_index D;
    matlib_xv quadW;
    fem2d_cc xi_D;


    for (D = 3; D < 51; D++)
    {
        m = (matlib_index) (D/2); 
        n = D - m - 2;
        fem2d_symq(D, &xi_D, &quadW);

        e_relative = fem2d_check_quadM(xi_D, quadW, m, n);
        debug_exit( "D: %d, Relative error: %0.16f",
                    D, e_relative);
        if(isnan(e_relative))
        {
            CU_ASSERT_TRUE(false);
        }
        else
        {
            CU_ASSERT_TRUE(e_relative<TOL);
        }
        matlib_free(xi_D.elem_p);
        matlib_free(quadW.elem_p);
    }
}

void test_sort(void)
{
    matlib_index zeroth = 5;
    matlib_index ilist[8] = { 2, 19, 6, 15, 3, 18, 9, 11};
    matlib_index ilen = 8;
    matlib_int iorder[8];
    fem2d_sort_node_index(zeroth, ilist, ilen, iorder);

    fprintf(stderr, "\n");
    fprintf(stderr, "Zeroth: %d\n", zeroth);
    for( matlib_index i=0; i<8; i++)
    {
        fprintf(stderr, "%d ", ilist[i]);
    
    }
    fprintf(stderr, "\n");
    for( matlib_index i=0; i<8; i++)
    {
        fprintf(stderr, "%d ", iorder[i]);
    
    }
    fprintf(stderr, "\n");
}


void test_nnz(void)
{
    fem2d_ea ea;
    fem2d_create_ea(nodes, ia, NR_DOMAINS, &ea);
    fem2d_create_vp(&ea);
    matlib_index nnz = fem2d_get_nnz(ea);
    debug_body("NNZ: %d", nnz);

    matlib_index* col = calloc(nnz, sizeof(matlib_index));
    matlib_index* row = calloc(ea.nr_nodes + 1, sizeof(matlib_index));

    fem2d_GMMSparsity(ea, row, col);
    debug_body("NNZ: %d, last row element: %d", nnz, row[ea.nr_nodes]);
    
    BEGIN_DEBUG
        matlib_index i, j;
        for (i = 0; i < ea.nr_nodes; i++)
        {
            for (j = row[i]; j < row[i+1]; j++)
            {
                debug_print("GMM[%d][%d]: X", i, col[j]);
            }
        }
    END_DEBUG


    fem2d_free_ea(ea);

}

    
static void full_sym_mat
(
    matlib_xm_sparse sM,
    matlib_xm*      M
)
{
    matlib_index i, j;
    
    matlib_create_xm( sM.lenc, sM.lenr, M, MATLIB_ROW_MAJOR, MATLIB_NO_TRANS);    

    for(i=0; i<sM.lenc; i++)
    {
        j = sM.rowIn[i];
        M->elem_p[i*sM.lenr+sM.colIn[j]] = sM.elem_p[j];
        if(j != i)
        {
            M->elem_p[sM.colIn[j]*sM.lenr+i] = sM.elem_p[j];
        }
        for(j=sM.rowIn[i]+1; j<sM.rowIn[i+1]; j++)
        {
            M->elem_p[i*sM.lenr+sM.colIn[j]] = sM.elem_p[j];
            M->elem_p[sM.colIn[j]*sM.lenr+i] = sM.elem_p[j];
        }
    }

}


/*  Projection of phi(x)u on vertex basis can be obtained by computing the
 *  projection directly, or, using the mass-matrix for phi(x) and multiplying it
 *  with the vertex basis representation of u.
 *
 * we test the equality of the two to ensure the consistency of imlementation.
 * Let phi(x) = x.
 *
 * */ 
void test_xGMM_a(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(nodes, ia, NR_DOMAINS, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    matlib_xm vphi;
    error = fem2d_refbasis(xi, &vphi);
    
    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_xv u_nodes;
    error = matlib_create_xv( nodes.len, &u_nodes , MATLIB_COL_VECT);

    error = poly_xfunc(nodes, u_nodes);

    matlib_xv u_prj;
    error = matlib_create_xv( nodes.len, &u_prj , MATLIB_COL_VECT);

    /* quadW: quadrature weights */ 
    matlib_xv quadW = {.len = NR_QNODES, .elem_p = (matlib_real*)qwa};

    matlib_xm Q;
    error = fem2d_quadM( vphi, quadW, &Q);

    matlib_xv phi;
    error = matlib_create_xv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = 1.0;

    }
    matlib_xm_sparse M;
    error = fem2d_xm_sparse_GMM( ea, Q, phi, &M);

    BEGIN_DEBUG
        matlib_index i, j;
        for (i = 0; i < ea.nr_nodes; i++)
        {
            for (j = M.rowIn[i]; j < M.rowIn[i+1]; j++)
            {
                debug_print( "GMM[%d][%d]: %0.16f",
                             i, M.colIn[j], M.elem_p[j]);
            }
        }
    END_DEBUG

    error = fem2d_NB_xprj(ea, u_nodes, u_prj);

    matlib_xv u_prj1;
    error = matlib_create_xv( nodes.len, &u_prj1 , MATLIB_COL_VECT);

    matlib_xcsrsymv(MATLIB_UPPER, M, u_nodes, u_prj1);

    BEGIN_DEBUG
        matlib_index i;
        for (i = 0; i < u_prj.len; i++ )
        {
            debug_print( "[%d]-> |u_prj - u_prj1|: %0.16f",
                         i, fabs(u_prj.elem_p[i] - u_prj1.elem_p[i]));
        }
    END_DEBUG


    matlib_real norm_actual = matlib_xnrm2(u_prj);
    matlib_xaxpy(-1.0, u_prj, u_prj1);
    matlib_real e_relative = matlib_xnrm2(u_prj1)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative<TOL);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_prj1.elem_p);
    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);
}

void test_xGMM_b(void)
{
    fem2d_err error = FEM2D_SUCCESS;
    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    matlib_index mcnt = 0;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);
    
    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_xv u_nodes, v_qnodes;
    error = matlib_create_xv( my_nodes.len,  &u_nodes, MATLIB_COL_VECT);
    error = matlib_create_xv( x_qnodes.len, &v_qnodes, MATLIB_COL_VECT);

    error = Gaussian_xfunc(my_nodes, u_nodes);
    error = Gaussian_xfunc(x_qnodes, v_qnodes);

    matlib_xv u_prj;
    error = matlib_create_xv( my_nodes.len, &u_prj , MATLIB_COL_VECT);


    matlib_xm Q, quadP;
    error = fem2d_quadM( vphi, quadW, &Q);
    error = fem2d_quadP( vphi, quadW, &quadP);
    
    matlib_xv phi;
    error = matlib_create_xv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = (1.0 + x_qnodes.elem_p[i]);
        v_qnodes.elem_p[i] = v_qnodes.elem_p[i] * phi.elem_p[i];
    }
    matlib_xm_sparse M;
    error = fem2d_xm_sparse_GMM( ea, Q, phi, &M);

    error = fem2d_xprj(ea, v_qnodes, quadP, u_prj);

    matlib_xv u_prj1;
    error = matlib_create_xv( my_nodes.len, &u_prj1 , MATLIB_COL_VECT);

    matlib_xcsrsymv(MATLIB_UPPER, M, u_nodes, u_prj1);

    matlib_real norm_actual = matlib_xnrm2(u_prj);
    matlib_xaxpy(-1.0, u_prj, u_prj1);
    matlib_real e_relative = matlib_xnrm2(u_prj1)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 3*TOL_NB);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(v_qnodes.elem_p);
    matlib_free(u_nodes.elem_p);
    matlib_free(quadW.elem_p);
    matlib_free(quadP.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);

}

void test_xGMM_c(void)
{
    fem2d_err error = FEM2D_SUCCESS;
    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    matlib_index mcnt = 0;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 5;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);
    
    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_xv u_nodes, u_exact, v_qnodes;
    error = matlib_create_xv( my_nodes.len,  &u_nodes, MATLIB_COL_VECT);
    error = matlib_create_xv( my_nodes.len,  &u_exact, MATLIB_COL_VECT);
    error = matlib_create_xv( x_qnodes.len, &v_qnodes, MATLIB_COL_VECT);

    error = Gaussian_xfunc(my_nodes, u_exact);
    error = Gaussian_xfunc(x_qnodes, v_qnodes);

    matlib_xv u_prj;
    error = matlib_create_xv( my_nodes.len, &u_prj , MATLIB_COL_VECT);


    matlib_xm Q, quadP;
    error = fem2d_quadM( vphi, quadW, &Q);
    error = fem2d_quadP( vphi, quadW, &quadP);
    
    matlib_xv phi;
    error = matlib_create_xv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = (1.0 + sin(M_PI * x_qnodes.elem_p[i]));
        v_qnodes.elem_p[i] = v_qnodes.elem_p[i] * phi.elem_p[i];
    }
    matlib_xm_sparse M;
    error = fem2d_xm_sparse_GMM( ea, Q, phi, &M);

    error = fem2d_xprj(ea, v_qnodes, quadP, u_prj);

    /* Initialize solver data */ 
    pardiso_solver_t data = { .nsparse  = 1, 
                              .mnum     = 1, 
                              .mtype    = PARDISO_REAL_SYM_INDEF,
                              .sol_enum = PARDISO_LHS, 
                              .smat_p   = (void*)&M,
                              .rhs_p    = (void*)&u_prj,
                              .sol_p    = (void*)&u_nodes};

    debug_body("%s", "Solver data initialized");
    data.phase_enum = PARDISO_INIT;
    matlib_xpardiso(&data);

    data.phase_enum = PARDISO_ANALYSIS_AND_FACTOR;
    matlib_xpardiso(&data);

    data.phase_enum = PARDISO_SOLVE_AND_REFINE;
    matlib_xpardiso(&data);

    BEGIN_DEBUG
        matlib_index i;
        for (i = 0; i < u_nodes.len; i++ )
        {
            debug_print( "[%d]-> u_nodes: %0.16f, u_exact: %0.16f",
                         i, u_nodes.elem_p[i], u_exact.elem_p[i]);
        }
    END_DEBUG

    matlib_real norm_actual = matlib_xnrm2(u_exact);
    matlib_xaxpy(-1.0, u_nodes, u_exact);
    matlib_real e_relative = matlib_xnrm2(u_exact)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 3*TOL_NB);
    
    data.phase_enum = PARDISO_FREE;
    matlib_xpardiso(&data);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(v_qnodes.elem_p);
    matlib_free(u_nodes.elem_p);
    matlib_free(u_exact.elem_p);
    matlib_free(quadW.elem_p);
    matlib_free(quadP.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);

}



void test_zGMM_a(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(nodes, ia, NR_DOMAINS, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    matlib_xm vphi;
    error = fem2d_refbasis(xi, &vphi);
    
    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_zv u_nodes;
    error = matlib_create_zv( nodes.len, &u_nodes , MATLIB_COL_VECT);

    error = poly_zfunc(nodes, u_nodes);

    matlib_zv u_prj;
    error = matlib_create_zv( nodes.len, &u_prj , MATLIB_COL_VECT);

    /* quadW: quadrature weights */ 
    matlib_xv quadW = {.len = NR_QNODES, .elem_p = (matlib_real*)qwa};

    matlib_xm Q;
    error = fem2d_quadM( vphi, quadW, &Q);

    matlib_zv phi;
    error = matlib_create_zv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = (1.0 + 1.0*I);

    }
    matlib_zm_sparse M;
    error = fem2d_zm_sparse_GMM( ea, Q, phi, &M);

    BEGIN_DEBUG
        matlib_index i, j;
        for (i = 0; i < ea.nr_nodes; i++)
        {
            for (j = M.rowIn[i]; j < M.rowIn[i+1]; j++)
            {
                debug_print( "GMM[%d][%d]: %0.16f%+0.16fi",
                             i, M.colIn[j], M.elem_p[j]);
            }
        }
    END_DEBUG

    error = fem2d_NB_zprj(ea, u_nodes, u_prj);

    matlib_zv u_prj1;
    error = matlib_create_zv( nodes.len, &u_prj1 , MATLIB_COL_VECT);

    matlib_zcsrsymv(MATLIB_UPPER, M, u_nodes, u_prj1);

    matlib_complex alpha = -1.0-1.0*I; 
    BEGIN_DEBUG
        matlib_index i;
        for (i = 0; i < u_prj.len; i++ )
        {
            debug_print( "[%d]-> |u_prj - u_prj1|: %0.16f",
                         i, cabs(alpha * u_prj.elem_p[i] + u_prj1.elem_p[i]));
        }
    END_DEBUG


    matlib_real norm_actual = matlib_znrm2(u_prj);
    /* scale the projection by the value of the constant potential */ 
    matlib_zaxpy(alpha, u_prj, u_prj1);
    matlib_real e_relative = matlib_znrm2(u_prj1)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative<TOL);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_prj1.elem_p);
    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);
}

void test_zGMM_b(void)
{
    fem2d_err error = FEM2D_SUCCESS;
    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    matlib_index mcnt = 0;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);
    
    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_zv u_nodes, v_qnodes;
    error = matlib_create_zv( my_nodes.len,  &u_nodes, MATLIB_COL_VECT);
    error = matlib_create_zv( x_qnodes.len, &v_qnodes, MATLIB_COL_VECT);

    error = Gaussian_zfunc(my_nodes, u_nodes);
    error = Gaussian_zfunc(x_qnodes, v_qnodes);

    matlib_zv u_prj;
    error = matlib_create_zv( my_nodes.len, &u_prj , MATLIB_COL_VECT);


    matlib_xm Q, quadP;
    error = fem2d_quadM( vphi, quadW, &Q);
    error = fem2d_quadP( vphi, quadW, &quadP);
    
    matlib_zv phi;
    error = matlib_create_zv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = (1.0 + I*x_qnodes.elem_p[i]);
        v_qnodes.elem_p[i] = v_qnodes.elem_p[i] * phi.elem_p[i];
    }
    matlib_zm_sparse M;
    error = fem2d_zm_sparse_GMM( ea, Q, phi, &M);

    error = fem2d_zprj(ea, v_qnodes, quadP, u_prj);

    matlib_zv u_prj1;
    error = matlib_create_zv( my_nodes.len, &u_prj1 , MATLIB_COL_VECT);

    matlib_zcsrsymv(MATLIB_UPPER, M, u_nodes, u_prj1);

    matlib_real norm_actual = matlib_znrm2(u_prj);
    matlib_zaxpy(-1.0, u_prj, u_prj1);
    matlib_real e_relative = matlib_znrm2(u_prj1)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 3*TOL_NB);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(v_qnodes.elem_p);
    matlib_free(u_nodes.elem_p);
    matlib_free(quadW.elem_p);
    matlib_free(quadP.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);

}


void test_zGMM_c(void)
{
    fem2d_err error = FEM2D_SUCCESS;
    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    matlib_index mcnt = 0;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);
    
    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_zv u_nodes, u_exact, v_qnodes;
    error = matlib_create_zv( my_nodes.len,  &u_nodes, MATLIB_COL_VECT);
    error = matlib_create_zv( my_nodes.len,  &u_exact, MATLIB_COL_VECT);
    error = matlib_create_zv( x_qnodes.len, &v_qnodes, MATLIB_COL_VECT);

    error = Gaussian_zfunc(my_nodes, u_exact);
    error = Gaussian_zfunc(x_qnodes, v_qnodes);

    matlib_zv u_prj;
    error = matlib_create_zv( my_nodes.len, &u_prj , MATLIB_COL_VECT);


    matlib_xm Q, quadP;
    error = fem2d_quadM( vphi, quadW, &Q);
    error = fem2d_quadP( vphi, quadW, &quadP);
    
    matlib_zv phi;
    error = matlib_create_zv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = (1.0 + I * sin(M_PI * x_qnodes.elem_p[i]));
        v_qnodes.elem_p[i] = v_qnodes.elem_p[i] * phi.elem_p[i];
    }
    matlib_zm_sparse M;
    error = fem2d_zm_sparse_GMM( ea, Q, phi, &M);

    error = fem2d_zprj(ea, v_qnodes, quadP, u_prj);

    /* Initialize solver data */ 
    pardiso_solver_t data = { .nsparse  = 1, 
                              .mnum     = 1, 
                              .mtype    = PARDISO_COMPLEX_SYM,
                              .sol_enum = PARDISO_LHS, 
                              .smat_p   = (void*)&M,
                              .rhs_p    = (void*)&u_prj,
                              .sol_p    = (void*)&u_nodes};

    debug_body("%s", "Solver data initialized");
    data.phase_enum = PARDISO_INIT;
    matlib_zpardiso(&data);

    data.phase_enum = PARDISO_ANALYSIS_AND_FACTOR;
    matlib_zpardiso(&data);

    data.phase_enum = PARDISO_SOLVE_AND_REFINE;
    matlib_zpardiso(&data);

    BEGIN_DEBUG
        matlib_index i;
        for (i = 0; i < u_nodes.len; i++ )
        {
            debug_print( "[%d]-> u_nodes: %0.16f%+0.16fi, u_exact: %0.16f%+0.16f",
                         i, u_nodes.elem_p[i], u_exact.elem_p[i]);
        }
    END_DEBUG

    matlib_real norm_actual = matlib_znrm2(u_exact);
    matlib_zaxpy(-1.0, u_nodes, u_exact);
    matlib_real e_relative = matlib_znrm2(u_exact)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 3*TOL_NB);
    
    data.phase_enum = PARDISO_FREE;
    matlib_zpardiso(&data);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(v_qnodes.elem_p);
    matlib_free(u_nodes.elem_p);
    matlib_free(u_exact.elem_p);
    matlib_free(quadW.elem_p);
    matlib_free(quadP.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);

}
/*============================================================================*/
/* Solve Poisson's equation to test the stiffness-matrix routine.
 *
 * div(gard u) + rho = 0 with natural buondary conditions.
 *
 * rho = 4*a*exp(-a*(x^2 + y^2))*(1 - a*x^2 - a*y^2)
 *
 * Solution: u = exp(-a(x^2+y^2))
 *
 * */ 

matlib_real fem2d_NB_xnorm_sH1
(
    fem2d_ea  ea,
    matlib_xv S,
    matlib_xv u_nodes /* values at the nodes */ 
)
{
    debug_enter( "nr of domains: %d", ea.len);
    
    err_check(    (ea.elem_p      == NULL)    
               || (S.elem_p       == NULL)
               || (u_nodes.elem_p == NULL), clean_up, 
               "%s", "Null pointers ecountered!");

    err_check(    (u_nodes.len != ea.nr_nodes) 
               || (S.len       != ea.len * FEM2D_NR_COMBI), clean_up, 
               "Dimension mis-match (u_nodes: %d, nr nodes: %d, S: %d)!",
               u_nodes.len, ea.nr_nodes, S.len);

    fem2d_te* dptr; /* domain pointer */
    
    matlib_real* uptr0 = u_nodes.elem_p; /* base address */ 
    matlib_real* sptr  = S.elem_p;
    matlib_real* uptr;
    matlib_index offset1, offset2, offset3;
    matlib_real jacob;
    matlib_real f1, f2, f3;
    matlib_real f11, f12, f13, f23, f22, f33;

    matlib_real sum = 0;
    for ( dptr = ea.elem_p; 
          dptr < (ea.len + ea.elem_p); dptr++, sptr += FEM2D_NR_COMBI)
    {
        jacob = dptr->jacob;
        
        /* Get the first vertex */ 

        offset1 = dptr->nindex_p[FEM2D_INDEX_V1];
        offset2 = dptr->nindex_p[FEM2D_INDEX_V2];
        offset3 = dptr->nindex_p[FEM2D_INDEX_V3];

        uptr = uptr0 + offset1; f1 = *uptr;
        uptr = uptr0 + offset2; f2 = *uptr;
        uptr = uptr0 + offset3; f3 = *uptr;

        f11 = 2 * f1 * f1 * jacob;
        f22 = 2 * f2 * f2 * jacob;
        f33 = 2 * f3 * f3 * jacob;

        f12 = 4 * (f1 * f2) * jacob;
        f13 = 4 * (f1 * f3) * jacob;
        f23 = 4 * (f2 * f3) * jacob;
        
        sum += (   sptr[FEM2D_INDEX_V11] * f11
                 + sptr[FEM2D_INDEX_V12] * f12 
                 + sptr[FEM2D_INDEX_V13] * f13 
                 + sptr[FEM2D_INDEX_V22] * f22 
                 + sptr[FEM2D_INDEX_V23] * f23 
                 + sptr[FEM2D_INDEX_V33] * f33 );

    }

    debug_exit("Exit Status: %s", "SUCCESS" );
    return sqrt(sum);

clean_up:
    debug_exit("Exit Status: %s", "FAILURE" );
    return MATLIB_NAN;

} /* End of fem2d_NB_xnormL2 */ 

fem2d_err fem2d_NB_xprj_sH1
/* Projection from nodal basis representation */ 
(
    fem2d_ea  ea,
    matlib_xv S,
    matlib_xv u_nodes, /* values at the nodes */ 
    matlib_xv u_prj
)
{
    debug_enter( "nr of domains: %d", ea.len);
    
    err_check(    (ea.elem_p      == NULL)    
               || (u_nodes.elem_p == NULL)
               || (u_prj.elem_p   == NULL), clean_up, 
               "%s", "Null pointers ecountered!");

    err_check(    (u_nodes.len != ea.nr_nodes) 
               || (u_prj.len   != ea.nr_nodes), clean_up, 
               "Dimension mis-match (u_nodes: %d, u_prj: %d, nr nodes: %d)!",
               u_nodes.len, u_prj.len, ea.nr_nodes);

    fem2d_te* dptr; /* domain pointer */
    
    matlib_real* uptr0     = u_nodes.elem_p; /* base address */ 
    matlib_real* uprj_ptr0 = u_prj.elem_p; /* base address */ 
    matlib_real* sptr  = S.elem_p;
    matlib_real* uprj_ptr;
    matlib_real* uptr;
    matlib_index offset1, offset2, offset3;
    matlib_real jacob;
    matlib_real f1, f2, f3;

    /* Clear the existing values */
    for ( uprj_ptr = uprj_ptr0; 
          uprj_ptr < uprj_ptr0 + u_prj.len; uprj_ptr++)
    {
        *uprj_ptr = 0.0;
    }

    for ( dptr = ea.elem_p; 
          dptr < (ea.len + ea.elem_p); 
          dptr++, sptr += FEM2D_NR_COMBI)
    {
        jacob = dptr->jacob;
        
        /* Get the first vertex */ 

        offset1 = dptr->nindex_p[FEM2D_INDEX_V1];
        offset2 = dptr->nindex_p[FEM2D_INDEX_V2];
        offset3 = dptr->nindex_p[FEM2D_INDEX_V3];

        uptr = uptr0 + offset1; f1 = 2.0 * *uptr * jacob;
        uptr = uptr0 + offset2; f2 = 2.0 * *uptr * jacob;
        uptr = uptr0 + offset3; f3 = 2.0 * *uptr * jacob;

        /* ===== */ 
        uprj_ptr = uprj_ptr0 + offset1;
        
        (*uprj_ptr) += (   sptr[FEM2D_INDEX_V11] * f1
                         + sptr[FEM2D_INDEX_V12] * f2
                         + sptr[FEM2D_INDEX_V13] * f3);
        
        /* ===== */ 
        uprj_ptr = uprj_ptr0 + offset2;
        
        (*uprj_ptr) += (   sptr[FEM2D_INDEX_V12] * f1
                         + sptr[FEM2D_INDEX_V22] * f2
                         + sptr[FEM2D_INDEX_V23] * f3);

        /* ===== */ 
        uprj_ptr = uprj_ptr0 + offset3;
        
        (*uprj_ptr) += (   sptr[FEM2D_INDEX_V13] * f1
                         + sptr[FEM2D_INDEX_V23] * f2
                         + sptr[FEM2D_INDEX_V33] * f3);
    }

    debug_exit("Exit Status: %s", "SUCCESS" );
    return FEM2D_SUCCESS;

clean_up:
    debug_exit("Exit Status: %s", "FAILURE" );
    return FEM2D_FAILURE;

} /* End of fem2d_NB_xprj */ 

fem2d_err fem2d_NB_zprj_sH1
(
    fem2d_ea  ea,
    matlib_xv S,
    matlib_zv u_nodes, /* values at the nodes */ 
    matlib_zv u_prj
)
{
    debug_enter( "nr of domains: %d", ea.len);
    
    err_check(    (ea.elem_p      == NULL)    
               || (u_nodes.elem_p == NULL)
               || (u_prj.elem_p   == NULL), clean_up, 
               "%s", "Null pointers ecountered!");

    err_check( (u_nodes.len != ea.nr_nodes), clean_up, 
               "Dimension mis-match (u_nodes: %d, nr nodes: %d)!",
               u_nodes.len, ea.nr_nodes);

    fem2d_te* dptr; /* domain pointer */
    
    matlib_complex* uptr0     = u_nodes.elem_p; /* base address */ 
    matlib_complex* uprj_ptr0 = u_prj.elem_p; /* base address */ 
    matlib_real*    sptr      = S.elem_p;
    matlib_complex* uprj_ptr;
    matlib_complex* uptr;
    matlib_index offset1, offset2, offset3;
    matlib_real jacob;
    matlib_complex f1, f2, f3;

    /* Clear the existing values */
    for ( uprj_ptr = uprj_ptr0; 
          uprj_ptr < uprj_ptr0 + u_prj.len; uprj_ptr++)
    {
        *uprj_ptr = 0.0;
    }


    for ( dptr = ea.elem_p; 
          dptr < (ea.len + ea.elem_p); 
          dptr++, sptr += FEM2D_NR_COMBI)
    {
        jacob = dptr->jacob;
        
        /* Get the first vertex */ 

        offset1 = dptr->nindex_p[FEM2D_INDEX_V1];
        offset2 = dptr->nindex_p[FEM2D_INDEX_V2];
        offset3 = dptr->nindex_p[FEM2D_INDEX_V3];

        uptr = uptr0 + offset1; f1 = 2.0 * *uptr * jacob;
        uptr = uptr0 + offset2; f2 = 2.0 * *uptr * jacob;
        uptr = uptr0 + offset3; f3 = 2.0 * *uptr * jacob;

        /* ===== */ 
        uprj_ptr = uprj_ptr0 + offset1;
        
        (*uprj_ptr) += (   sptr[FEM2D_INDEX_V11] * f1
                         + sptr[FEM2D_INDEX_V12] * f2
                         + sptr[FEM2D_INDEX_V13] * f3);
        
        /* ===== */ 
        uprj_ptr = uprj_ptr0 + offset2;
        
        (*uprj_ptr) += (   sptr[FEM2D_INDEX_V12] * f1
                         + sptr[FEM2D_INDEX_V22] * f2
                         + sptr[FEM2D_INDEX_V23] * f3);

        /* ===== */ 
        uprj_ptr = uprj_ptr0 + offset3;
        
        (*uprj_ptr) += (   sptr[FEM2D_INDEX_V13] * f1
                         + sptr[FEM2D_INDEX_V23] * f2
                         + sptr[FEM2D_INDEX_V33] * f3);
    }

    debug_exit("Exit Status: %s", "SUCCESS" );
    return FEM2D_SUCCESS;

clean_up:
    debug_exit("Exit Status: %s", "FAILURE" );
    return FEM2D_FAILURE;

} /* End of fem2d_NB_zprj */ 








void test_NB_xnorm_sH1(void)
/* 
 * Gradient of exp(-a*(x^2+y^2))
 * -2*a*x*exp(-a*(x^2 + y^2))
 * -2*a*y*exp(-a*(x^2 + y^2))
 *
 *  ||Grad(u)||_{L2}=4
 *
 * */ 
{

fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    matlib_xv u_nodes;
    error = matlib_create_xv( my_nodes.len, &u_nodes , MATLIB_COL_VECT);

    error = Gaussian_xfunc(my_nodes, u_nodes);

    matlib_xv S;
    error = fem2d_SI_coeff( ea, &S);

    matlib_real semi_norm = fem2d_NB_xnorm_sH1(ea, S, u_nodes);
    debug_body("Semi norm: %0.16g", semi_norm);

    matlib_real snorm_actual = sqrt(M_PI);

    matlib_real e_relative = fabs(semi_norm-snorm_actual)/snorm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 9.5*TOL_NB);
}

void test_xGSM_a(void)
{
    fem2d_err error = FEM2D_SUCCESS;
    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    matlib_index mcnt = 0;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);
    
    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_xv u_nodes;
    error = matlib_create_xv( my_nodes.len,  &u_nodes, MATLIB_COL_VECT);

    error = Gaussian_xfunc(my_nodes, u_nodes);

    matlib_xv u_prj;
    error = matlib_create_xv( my_nodes.len, &u_prj , MATLIB_COL_VECT);

    matlib_xv S;
    error = fem2d_SI_coeff( ea, &S);

    error = fem2d_NB_xprj_sH1(ea, S, u_nodes, u_prj);

    matlib_xv phi;
    error = matlib_create_xv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = 1.0;
    }
    matlib_xm_sparse M;
    error = fem2d_xm_sparse_GSM( ea, S, quadW, phi, &M);

    matlib_xv u_prj1;
    error = matlib_create_xv( my_nodes.len, &u_prj1 , MATLIB_COL_VECT);

    matlib_xcsrsymv(MATLIB_UPPER, M, u_nodes, u_prj1);
    BEGIN_DEBUG
        matlib_index i;
        for (i = 0; i < u_prj.len; i++ )
        {
            debug_print( "[%d]-> u_prj: %0.16f,  u_prj1: %0.16f",
                         i, u_prj.elem_p[i], u_prj1.elem_p[i]);
        }
    END_DEBUG

    matlib_real norm_actual = matlib_xnrm2(u_prj);
    matlib_xaxpy(-1.0, u_prj, u_prj1);
    matlib_real e_relative = matlib_xnrm2(u_prj1)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 8*TOL);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(u_nodes.elem_p);
    matlib_free(quadW.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);

}


void test_zGSM_a(void)
{
    fem2d_err error = FEM2D_SUCCESS;
    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    matlib_index mcnt = 0;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 10;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);
    
    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_zv u_nodes;
    error = matlib_create_zv( my_nodes.len,  &u_nodes, MATLIB_COL_VECT);

    error = Gaussian_zfunc(my_nodes, u_nodes);
    DEBUG_PRINT_ZV(u_nodes, "%s", "");

    matlib_zv u_prj;
    error = matlib_create_zv( my_nodes.len, &u_prj , MATLIB_COL_VECT);

    matlib_xv S;
    error = fem2d_SI_coeff( ea, &S);

    error = fem2d_NB_zprj_sH1(ea, S, u_nodes, u_prj);

    matlib_zv phi;
    error = matlib_create_zv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = 1.0 + I*1.0;
    }
    matlib_zm_sparse M;
    error = fem2d_zm_sparse_GSM( ea, S, quadW, phi, &M);

    matlib_zv u_prj1;
    error = matlib_create_zv( my_nodes.len, &u_prj1 , MATLIB_COL_VECT);

    matlib_zcsrsymv(MATLIB_UPPER, M, u_nodes, u_prj1);
    matlib_complex alpha = -1.0-1.0*I; 
    BEGIN_DEBUG
        matlib_index i;
        for (i = 0; i < u_prj.len; i++ )
        {
            debug_print( "[%d]-> u_prj: %0.16f%+0.16fi, u_prj1: %0.16f%+0.16fi", i, 
                    creal(u_prj.elem_p[i]),
                    cimag(u_prj.elem_p[i]),
                    creal(u_prj1.elem_p[i]),
                    cimag(u_prj1.elem_p[i]));
        }
    END_DEBUG

    matlib_real norm_actual = matlib_znrm2(u_prj);
    matlib_zaxpy(alpha, u_prj, u_prj1);
    matlib_real e_relative = matlib_znrm2(u_prj1)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < 8*TOL);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(u_nodes.elem_p);
    matlib_free(quadW.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);

}


/*============================================================================*/



fem2d_err field_xfunc
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = exp(-16.0 * (ptr[0]*ptr[0] + ptr[1] * ptr[1]));
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}


fem2d_err rho_xfunc
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    matlib_real a = 16.0, arg;
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        arg = a * (ptr[0]*ptr[0] + ptr[1] * ptr[1]);
        *uptr = 4.0 * a * exp(-arg) * (1.0 - arg);
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}

fem2d_err field_xfunc1
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = sin(M_PI*ptr[0])*sin(M_PI*ptr[1]);
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}


fem2d_err rho_xfunc1
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;

    matlib_real factor = 2.0*M_PI*M_PI;
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = factor*sin(M_PI*ptr[0])*sin(M_PI*ptr[1]);
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}
/* - 2*a^2 - 2*b^2 + 2*x^2 + 2*y^2 
 * */    

fem2d_err field_xfunc2
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;
    matlib_real a = 1.0, b = 1.0; 
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = (ptr[0]*ptr[0] - a*a) * (ptr[1]*ptr[1] - b*b);
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}


fem2d_err rho_xfunc2
(
    fem2d_cc nodes_tmp, 
    matlib_xv u_nodes
)
{
    debug_enter( "nodes: %d, u_nodes: %d", 
                 nodes_tmp.len, u_nodes.len);
    err_check(( nodes_tmp.len != u_nodes.len), clean_up, 
                "Dimension mismatch (nodes: %d, u_nodes: %d)!", 
                nodes_tmp.len, u_nodes.len);
    matlib_real* ptr;
    matlib_real* uptr = u_nodes.elem_p;

    matlib_real a = 1.0, b = 1.0; 
    for ( ptr = nodes_tmp.elem_p; 
          ptr < (nodes_tmp.elem_p + 2 * (nodes_tmp.len)); ptr+=2, uptr++)
    {
        *uptr = - 2.0 * (ptr[0]*ptr[0] - a*a) - 2.0 * (ptr[1]*ptr[1] - b*b);
    }
    debug_exit("exit status: %d", FEM2D_SUCCESS);
    return FEM2D_SUCCESS;
clean_up:
    debug_exit("exit status: %d", FEM2D_FAILURE);
    return FEM2D_FAILURE;
}


void test_xGSM_b(void)
{
    fem2d_err error = FEM2D_SUCCESS;
    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    matlib_index mcnt = 0;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 4;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);
    
    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);
    
    matlib_xv u_nodes, v_qnodes;
    error = matlib_create_xv( my_nodes.len,  &u_nodes, MATLIB_COL_VECT);
    error = matlib_create_xv( x_qnodes.len, &v_qnodes, MATLIB_COL_VECT);

    error = field_xfunc2(my_nodes, u_nodes);
    error = rho_xfunc2(x_qnodes, v_qnodes);
#if 1
    BEGIN_DEBUG
        matlib_index i;
        for (i = 0; i < ea.nr_nodes; i++ )
        {
            debug_print( "%s, (x1: %0.5f, x2: %0.5f), u_nodes[%d]: %0.16f", 
                         FEM2D_POINT_T_ENUM2STR(ea.vpatch_p[i].point_enum),
                         my_nodes.elem_p[2*i+0], my_nodes.elem_p[2*i+1],
                         i, u_nodes.elem_p[i]);
        }
    END_DEBUG
#endif

    matlib_xv u_prj;
    error = matlib_create_xv( my_nodes.len, &u_prj , MATLIB_COL_VECT);


    matlib_xm quadP;
    error = fem2d_quadP( vphi, quadW, &quadP);
    
    error = fem2d_xprj(ea, v_qnodes, quadP, u_prj);

    matlib_xv S;
    error = fem2d_SI_coeff( ea, &S);

    matlib_xv phi;
    error = matlib_create_xv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = 1.0;
    }
    matlib_xm_sparse M;
    error = fem2d_xm_sparse_GSM( ea, S, quadW, phi, &M);

    matlib_xv u_prj1;
    error = matlib_create_xv( my_nodes.len, &u_prj1 , MATLIB_COL_VECT);

    matlib_xcsrsymv(MATLIB_UPPER, M, u_nodes, u_prj1);
#if 1
    BEGIN_DEBUG
        matlib_index i;
        for (i = 0; i < ea.nr_nodes; i++ )
        {
            debug_print( "%s, [%d]-> u_prj: %0.16f,  u_prj1: %0.16f", 
                         FEM2D_POINT_T_ENUM2STR(ea.vpatch_p[i].point_enum),
                         i, u_prj.elem_p[i], u_prj1.elem_p[i]);
        }
    END_DEBUG
#endif
    matlib_real norm_actual = matlib_xnrm2(u_prj);
    matlib_xaxpy(-1.0, u_prj, u_prj1);
    matlib_real e_relative = matlib_xnrm2(u_prj1)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative < TOL_NB);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(v_qnodes.elem_p);
    matlib_free(u_nodes.elem_p);
    matlib_free(quadW.elem_p);
    matlib_free(quadP.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);

}

void test_xGSM_c(void)
{
    fem2d_err error = FEM2D_SUCCESS;

    matlib_index nr_domains;
    matlib_nv iv;
    fem2d_cc my_nodes;
    char* file_name = "mesh_data.bin";
    fem2d_getmesh(file_name, &my_nodes, &iv);
    nr_domains = iv.len/FEM2D_NV;

    /* ea: element array */ 
    fem2d_ea ea;
    error = fem2d_create_ea(my_nodes, iv.elem_p, nr_domains, &ea);
    error = fem2d_create_vp(&ea);

    /* vphi: matrix containing values of reference basis functions at 
     * quadrature points
     * */ 
    /* quadW: quadrature weights */ 
    matlib_index D = 3;
    matlib_xv quadW;
    fem2d_cc xi_D;
    fem2d_symq(D, &xi_D, &quadW);

    matlib_xm vphi;
    error = fem2d_refbasis(xi_D, &vphi);

    /* x_qnodes: mesh points for interpolation 
     * */ 
    fem2d_cc x_qnodes;
    error = fem2d_ref2mesh(ea, vphi, &x_qnodes);

    matlib_xv v_qnodes, u_nodes, u_exact;
    error = matlib_create_xv( x_qnodes.len, &v_qnodes, MATLIB_COL_VECT);
    error = matlib_create_xv( my_nodes.len, &u_nodes , MATLIB_COL_VECT);
    error = matlib_create_xv( my_nodes.len, &u_exact , MATLIB_COL_VECT);

    error = rho_xfunc2(x_qnodes, v_qnodes);
    error = field_xfunc2(my_nodes, u_exact);

    matlib_xv u_prj;
    error = matlib_create_xv( my_nodes.len, &u_prj , MATLIB_COL_VECT);

    matlib_xm quadP;
    error = fem2d_quadP( vphi, quadW, &quadP );

    error = fem2d_xprj(ea, v_qnodes, quadP, u_prj);

    matlib_xv S;
    error = fem2d_SI_coeff( ea, &S);

    matlib_xv phi;
    error = matlib_create_xv( x_qnodes.len, &phi , MATLIB_COL_VECT);

    matlib_index i;
    for (i = 0; i < x_qnodes.len; i++)
    {
        phi.elem_p[i] = 1.0;

    }
    matlib_xm_sparse M;
    error = fem2d_xm_sparse_GSM( ea, S, quadW, phi, &M);

    /* Initialize solver data */ 
    pardiso_solver_t data = { .nsparse  = 1, 
                              .mnum     = 1, 
                              .mtype    = PARDISO_REAL_SYM_INDEF,
                              .sol_enum = PARDISO_LHS, 
                              .smat_p   = (void*)&M,
                              .rhs_p    = (void*)&u_prj,
                              .sol_p    = (void*)&u_nodes};

    debug_body("%s", "Solver data initialized");
    data.phase_enum = PARDISO_INIT;
    matlib_pardiso(&data);

    data.phase_enum = PARDISO_ANALYSIS_AND_FACTOR;
    matlib_pardiso(&data);

    data.phase_enum = PARDISO_SOLVE_AND_REFINE;
    matlib_pardiso(&data);
#if 1
    BEGIN_DEBUG
        matlib_index i;
        for (i = 0; i < u_nodes.len; i++ )
        {
            debug_print( "[%d]-> u_nodes: %0.16f, u_exact: %0.16f",
                         i, u_nodes.elem_p[i], u_exact.elem_p[i]);
        }
    END_DEBUG
#endif

    matlib_real norm_actual = matlib_xnrm2(u_exact);
    matlib_xaxpy(-1.0, u_nodes, u_exact);
    matlib_real e_relative = matlib_xnrm2(u_exact)/norm_actual;

    debug_body("Relative error: %0.16g", e_relative);
    CU_ASSERT_TRUE(e_relative<TOL);
    
    data.phase_enum = PARDISO_FREE;
    matlib_pardiso(&data);

    matlib_free(M.elem_p);
    matlib_free(M.rowIn);
    matlib_free(M.colIn);

    matlib_free(u_nodes.elem_p);
    matlib_free(u_exact.elem_p);
    matlib_free(u_prj.elem_p);
    matlib_free(x_qnodes.elem_p);
    matlib_free(vphi.elem_p);
    fem2d_free_ea(ea);
}



/*============================================================================+/
 |  
 | 
 |
 |
 |
/+============================================================================*/

int main()
{
    CU_pSuite pSuite = NULL;

    /* initialize the CUnit test registry */
    if (CUE_SUCCESS != CU_initialize_registry())
    {
        return CU_get_error();
    }

    /* Create a test array */
    CU_TestInfo test_array[] = 
    {
#if 1
        { "Create vertex patch a"      , test_create_vp   },
        //{ "Create vertex patch b"      , test_create_vp1  },
        { "Create index array"         , test_create_ia   },
        { "Centroid a"                 , test_centroid_a  },
        { "Centroid b"                 , test_centroid_b  },
        { "Ref. basis"                 , test_refbasis    },
        { "Ref. to mesh"               , test_ref2mesh    },
        { "Interpolation real"         , test_xinterp     },
        { "Interpolation complex a"    , test_zinterp_a   },
        { "Interpolation complex b"    , test_zinterp_b   },
        { "L2 norm real"               , test_xnormL2     },
        { "L2 norm complex"            , test_znormL2     },
        { "Inner product real"         , test_xiprod      },
        { "Inner product complex"      , test_ziprod      },
        { "Quad. matrix, projection"   , test_quadP       },
        { "Projection real"            , test_xprj        },
        { "Projection complex"         , test_zprj        },
        { "L2 norm NB real"            , test_NB_xnormL2  },
        { "L2 norm NB complex"         , test_NB_znormL2  },
        { "Inner product NB real"      , test_NB_xiprod   },
        { "Inner product NB complex"   , test_NB_ziprod   },
        { "Projection NB real"         , test_NB_xprj     },
        { "Projection NB complex"      , test_NB_zprj     },
        { "Quad. matrix, GMM"          , test_quadM       },
        { "GMM real a"                 , test_xGMM_a      },
        { "GMM real b"                 , test_xGMM_b      },
        { "GMM real c"                 , test_xGMM_c      },
        { "GMM complex a"              , test_zGMM_a      },
        { "GMM complex b"              , test_zGMM_b      },
        { "GMM complex c"              , test_zGMM_c      },
        { "Semi-norm H1 real"          , test_NB_xnorm_sH1},
        { "GSM real a"                 , test_xGSM_a      },
        //{ "GSM real b"                 , test_xGSM_b      },
        { "GSM complex a"              , test_zGSM_a      },
#endif
        CU_TEST_INFO_NULL,
    };

    /* Create the test suite */ 
    CU_SuiteInfo suites[] = 
    {
        { "fem2d", init_suite, clean_suite, NULL, NULL, (CU_TestInfo*) test_array },
        CU_SUITE_INFO_NULL
    }; 

    /* Register test suites */ 
    CU_ErrorCode CU_error = CU_register_suites(suites); 
    if (CU_error != CUE_SUCCESS) 
    {
        debug_body("%s", CU_get_error_msg());
        CU_cleanup_registry();
        return CU_get_error();
    }


   /* Run all tests using the CUnit Basic interface */
   CU_basic_set_mode(CU_BRM_VERBOSE);
   CU_basic_run_tests();
   CU_cleanup_registry();
   return CU_get_error();
}
